"use strict";function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}var Main=function(a){_inheritsLoose(b,a);function b(){var b;b=a.call(this,{key:"Main"})||this;b.group=null;b.player=null;b.colors=null;b.options=null;b.solution=null;b.banTime=null;b.seedTime=null;b.startTime=null;return b}var c=b.prototype;c.init=function init(a){this.group=a.group;this.player=a.player;this.colors=a.colors;this.options=a.options;this.solution=a.solution;this.banTime=a.banTime;this.seedTime=a.seedTime};c.create=function create(){var a=this;var b=[];var c=0;var d=[];var e=Date.now();var f=this.add.group();var g=this.add.group();var h=this.options.length+2;var j={width:100,height:200,cellWidth:22,cellHeight:22,getPoints:function getPoints(a){var b=Array(j.width).fill(0);var c=b.length-1;var d=Phaser.Math.Between;var e=Phaser.Math.RND;var f=[];for(var g=0;g<a;g++){var h=d(0,c);var i=b[h]+=1;if(.01>e.frac()){i*=e.frac()}i%=j.height;i|=0;f[g]=new Phaser.Math.Vector2(16*h,16*i)}return f}};this.add.particles("code").createEmitter({alpha:{start:1,end:0,ease:"Expo.easeOut"},angle:0,blendMode:"ADD",emitZone:{source:j,type:"edge",quantity:2e3},frame:Phaser.Utils.Array.NumberArray(8,58),frequency:50,lifespan:2e3,quantity:20,scale:.6,tint:6282002}).setAlpha(.07);var k=new Button(this,65,65,"helpButton",function(){window.open("https://util.rxat.ro/wiki/index.php?title=Codeban","_blank")}).setBlendMode(Phaser.BlendModes.ADD);var l=new Button(this,this.cameras.main.width-38,38,"closeButton",closeGameBan);var m=this.add.dynamicBitmapText(0,0,"aero","Crack the code ("+this.solution.length+"/"+this.options.length+") to rejoin the chat!",100);m.setOrigin(.5).setAlpha(0).setScale(.3);m.x=this.cameras.main.centerX;m.y=this.cameras.main.centerY;var n=this.tweens.timeline({tweens:[{targets:m,scale:.55,alpha:.55,ease:"Quad.easeInOut",duration:300},{targets:m,alpha:1,ease:"Quad.easeInOut",duration:400},{targets:m,delay:300,scale:7,alpha:.4,ease:"Quad.easeInOut",duration:300},{targets:m,scale:15,alpha:0,duration:150,ease:"Quad.easeInOut",onStart:function onStart(){a.startTime=Date.now()/1e3;var c=a.add.graphics({fillStyle:{color:0,alpha:.07}}).setAlpha(0);c.fillRoundedRect(a.cameras.main.centerX-88*h/2,a.cameras.main.height-75,88*h,40,10);for(var o=0;o<h;o++){var p=1;if(0==o||o==h-1)p=0;f.add(a.add.sprite(90*o+a.cameras.main.centerX-90*(h-1)/2,a.cameras.main.height-100,"base",p));f.getChildren()[o].setAlpha(0);if(o==h-1)f.getChildren()[o].flipX=!0}var e=a.add.group();var j=Phaser.Utils.Array.Shuffle([].concat(a.options));j.forEach(function(b,c){g.add(new Smiley(a,100*c+a.cameras.main.centerX-100*(a.options.length-1)/2,a.cameras.main.height-130,b,a.colors[c]));e.add(g.getChildren()[c].container);e.getChildren()[c].y-=25;e.getChildren()[c].setAlpha(0)});a.tweens.add({targets:c,alpha:1,duration:200,ease:"Quad.easeInOut",easeParams:[1.5,1,.5],delay:50});a.tweens.add({targets:f.getChildren(),alpha:1,duration:200,ease:"Quad.easeInOut",easeParams:[1.5,1,.5],delay:50});var k=0;e.children.iterate(function(b){a.tweens.add({targets:b,y:b.y+25,alpha:1,duration:600,ease:"Elastic",easeParams:[1.5,1,.5],delay:50*k});k++});var l=a.add.group();var m=a.add.group();var n=a.add.graphics({fillStyle:{color:16777215,alpha:.15}}).setBlendMode(Phaser.BlendModes.ADD);g.getChildren().forEach(function(c,e){c.container.on("pointerup",function(e){c.isActive=!0;c.container.disableInteractive();b.push(c.name);d.push(c.color);if(b.length==a.solution.length){if(a.isSame(b,a.solution)){var f=document.getElementsByTagName("canvas")[0];var h=a.tweens.addCounter({from:0,to:1,duration:600,ease:"Quad.easeInOut",onUpdate:function onUpdate(){f.style.filter="blur("+40*h.getValue()+"px)";f.style.transform="scale("+(1+3*h.getValue())+")";f.style.opacity=1-h.getValue()},onComplete:function onComplete(){var b=new FormData;b.append("solution",JSON.stringify(a.solution));b.append("group",a.group);b.append("player",a.player);b.append("options",JSON.stringify(a.options));b.append("banTime",a.banTime);b.append("seedTime",a.seedTime);b.append("startTime",a.startTime);fetch("https://rxat.ro/web_gear/chat/codeban.php",{method:"POST",body:b}).then(function(a){return a.text()}).then(function(a){if(1==+a){closeGameBan()}else{location.reload()}}).catch(function(a){console.log("Error",a);location.reload()})}})}else{g.getChildren().forEach(function(a){a.isActive=!1;a.active.setAlpha(0);var b=new Date;var c=b.getMonth();if(10<=c){a.active2.setAlpha(0)}a.container.setInteractive()})}var i=70*(b.length-1)/2+60;var j=a.getMatches(b,a.solution);n.clear();l.add(new CodeRow(a,.35*75,.35*75,b,d));m.add(new SignsRow(a,0,0,j));for(var k=l.getLength()-1;0<=k;k--){var o=l.getChildren()[k];var p=m.getChildren()[k];var q=l.getLength()-1-k;if(5>=q){o.y=a.cameras.main.height-250-90*q;o.x=a.cameras.main.centerX-70*(b.length-1)/2-i;p.y=a.cameras.main.height-250-90*q;p.x=a.cameras.main.centerX-70*(b.length-1)/2+i;n.fillRoundedRect(a.cameras.main.centerX-73*b.length/2-i,a.cameras.main.height-287-90*q,73*b.length,75,25);n.fillRoundedRect(a.cameras.main.centerX-73*b.length/2+i,a.cameras.main.height-287-90*q,73*b.length,75,25)}else{o.destroy();p.destroy()}}b=[];d=[]}},a)})}}]});this.updates.addMultiple(g.getChildren())};c.getMatches=function getMatches(a,b){var c=[];if(a.length!=b.length){console.log("Arrays must have same length.");return null}for(var d=0;d<a.length;d++){if(a[d]==b[d]){c[d]=0}else if(-1!=b.indexOf(a[d])){c[d]=2}else{c[d]=1}}return c};c.isSame=function isSame(a,b){return a.length==b.length&&a.every(function(a,c){return a===b[c]})};return b}(Phaser.Scene);

