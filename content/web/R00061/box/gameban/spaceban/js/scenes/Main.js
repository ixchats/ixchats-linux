"use strict";function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}var Main=function(a){var c=Math.abs;_inheritsLoose(b,a);function b(){var b;b=a.call(this,{key:"Main"})||this;b.group=null;b.player=null;b.banTime=null;b.seedTime=null;b.startTime=null;b.randSeed=0;b.hours=0;b.ammo=0;b.ammoNum=0;b.moons=null;b.moonsConfig=[];b.ammos=null;b.usedAmmo=0;b.moonCount=0;b.killedMoons=0;b.rocket=null;b.ammoText=null;b.moonsText=null;b.speed=0;b.maxSpeed=400;b.direction=new Phaser.Math.Vector2;b.tries=0;b.cursors=null;b.gamerOver=!0;b.shootSound=null;b.explodeSound=null;b.explodeSound2=null;return b}var d=b.prototype;d.init=function init(a){this.group=a.group;this.player=a.player;this.banTime=a.banTime;this.seedTime=a.seedTime};d.create=function create(){var a=this;var b=new Button(this,this.cameras.main.width-38,38,"closeButton",closeGameBan);b.setDepth(3);this.hours=Math.round((this.banTime-this.seedTime)/3600);if(isNaN(this.hours)||1>this.hours){this.hours=1}else if(100<this.hours){this.hours=100}this.moons=this.add.group();this.createMoons();this.ammo=this.ammoNum=this.moonCount;this.ammos=this.add.group({classType:Ammo,runChildUpdate:!0});var c=this.add.dynamicBitmapText(this.cameras.main.centerX,this.cameras.main.centerY,"neuropol","Shoot "+this.moonCount+" moons to rejoin the chat!",85).setOrigin(.5);var d=this.tweens.timeline({tweens:[{targets:c,scale:.55,alpha:.55,ease:"Quad.easeInOut",duration:300},{targets:c,alpha:1,ease:"Quad.easeInOut",duration:400},{targets:c,delay:300,scale:7,alpha:.4,ease:"Quad.easeInOut",duration:300},{targets:c,scale:15,alpha:0,duration:150,ease:"Quad.easeInOut",onStart:function onStart(){a.startTime=Date.now()/1e3;a.rocket=new Rocket(a,a.cameras.main.centerX,a.cameras.main.centerY);a.moonsConfig.forEach(function(b){a.moons.add(new Moon(a,b),!0)});a.moonsText=a.add.dynamicBitmapText(14,5,"neuropol","Moons: "+a.moonCount,28).setOrigin(0).setTint(13088530).setDepth(3);a.ammoText=a.add.dynamicBitmapText(a.moonsText.x+a.moonsText.width+50,5,"neuropol","Ammo: "+a.ammo,28).setOrigin(0).setTint(13088530).setDepth(3);a.cursors=a.input.keyboard.createCursorKeys();a.shootSound=a.sound.add("shoot");a.explodeSound=a.sound.add("explode");a.explodeSound2=a.sound.add("explode2");a.input.keyboard.on("keydown-SPACE",function(b){if(a.gamerOver)return;b.stopPropagation();if(0==a.ammo)return;a.shootSound.play({volume:.35});var c=a.ammos.get();c.fire(a.rocket);a.updateAmmo(-1)});a.setColliders();a.gamerOver=!1}}]})};d.updateAmmo=function updateAmmo(a){var b=this;if(1<c(a)){this.time.addEvent({delay:100,callback:function callback(){b.ammoText.setText("Ammo: "+b.ammo++)},callbackScope:this,repeat:a})}else{this.ammo+=a;this.ammoText.setText("Ammo: "+this.ammo);this.usedAmmo-=a}};d.updateMoons=function updateMoons(){var a=this;this.killedMoons++;this.moonsText.setText("Moons: "+(this.moonCount-this.killedMoons));if(this.killedMoons==this.moonCount){this.gamerOver=!0;var b=document.getElementsByTagName("canvas")[0];var c=this.tweens.addCounter({from:0,to:1,duration:600,ease:"Quad.easeInOut",onUpdate:function onUpdate(){b.style.filter="blur("+40*c.getValue()+"px)";b.style.transform="scale("+(1+3*c.getValue())+")";b.style.opacity=1-c.getValue()},onComplete:function onComplete(){var b=new FormData;b.append("tries",a.tries);b.append("ammo",a.ammoNum);b.append("killed",a.killedMoons);b.append("moons",a.moonCount);b.append("player",a.player);b.append("group",a.group);b.append("banTime",a.banTime);b.append("seedTime",a.seedTime);b.append("startTime",a.startTime);fetch("https://rxat.ro/web_gear/chat/spaceban.php",{method:"POST",body:b}).then(function(a){return a.text()}).then(function(a){if(1==+a){closeGameBan()}else{location.reload()}}).catch(function(a){console.log("Error",a);location.reload()})}})}};d.setColliders=function setColliders(){var a=this;this.physics.add.overlap(this.ammos,this.moons,function(b,c){if(a.gamerOver)return;if(c.golden){a.updateAmmo(4*c.size);a.explodeSound2.play({volume:.7})}else{a.explodeSound.play({volume:.35})}if(1<c.size){var d=0;while(d<c.size){var e={size:1,x:c.x,y:c.y,golden:35>=Phaser.Math.Between(0,100)?!0:!1};a.moons.add(new Moon(a,e),!0);d++}}c.explode();b.destroy();a.updateMoons()},null,this);this.physics.add.overlap(this.rocket,this.moons,function(b,c){if(a.gamerOver)return;b.explode();a.explodeSound.play({volume:.35});a.restart("Rocket Destroyed!");a.gamerOver=!0},null,this)};d.restart=function restart(a){var b=this;var c=this.add.dynamicBitmapText(this.cameras.main.centerX,this.cameras.main.centerY,"neuropol",a,116).setOrigin(.5);c.setDepth(10);var d=this.tweens.timeline({tweens:[{targets:c,scale:.55,alpha:.55,ease:"Quad.easeInOut",duration:300},{targets:c,alpha:1,ease:"Quad.easeInOut",duration:400},{targets:c,delay:300,scale:7,alpha:.4,ease:"Quad.easeInOut",duration:300},{targets:c,scale:15,alpha:0,duration:150,ease:"Quad.easeInOut",onStart:function onStart(){b.reset()}}]})};d.createMoons=function createMoons(){this.moonsConfig=[];this.moons.clear(!0,!0);var a=this.hours;do{var b={};var d=this.xRand(3)+1;if(d+1>a)d-=a;if(1>d)d=1;if(1<d){a-=d;this.moonCount+=d+1}else{a--;this.moonCount++}do{b.x=Phaser.Math.Between(0,this.cameras.main.width)}while(150>c(b.x-this.cameras.main.centerX));do{b.y=Phaser.Math.Between(0,this.cameras.main.height)}while(150>c(b.y-this.cameras.main.centerY));b.size=d;b.golden=25>=Phaser.Math.Between(0,100)?!0:!1;this.moonsConfig.push(b)}while(0<a)};d.update=function update(a,b){if(this.gamerOver)return;if(this.cursors.left.isDown){this.rocket.body.setAngularVelocity(-250)}else if(this.cursors.right.isDown){this.rocket.body.setAngularVelocity(250)}else{this.rocket.body.setAngularVelocity(0)}if(this.cursors.up.isDown){this.physics.velocityFromRotation(this.rocket.rotation+Phaser.Math.DegToRad(90),-180,this.rocket.body.acceleration)}else if(this.cursors.down.isDown){this.physics.velocityFromRotation(this.rocket.rotation+Phaser.Math.DegToRad(90),180,this.rocket.body.acceleration)}else{this.rocket.body.setAcceleration(0)}this.physics.world.wrap(this.moons,32);this.physics.world.wrap(this.rocket,70);this.rocket.update();if(0<this.usedAmmo&&0==this.ammo&&0==this.ammos.getChildren().length){this.gamerOver=!0;this.rocket.engineSound.stop();this.restart("Out of Ammo!")}};d.reset=function reset(){var a=this;this.tries++;this.usedAmmo=0;this.killedMoons=0;this.moonCount=0;this.gamerOver=!1;this.rocket.destroy();this.rocket=new Rocket(this,this.cameras.main.centerX,this.cameras.main.centerY);this.ammos.clear(!0,!0);var b=2147483647&(this.player^this.banTime^this.seedTime);this.randSeed=2147483647&b;if(0==this.randSeed)this.randSeed++;this.createMoons();this.moonsConfig.forEach(function(b){a.moons.add(new Moon(a,b),!0)});this.ammo=this.ammoNum=this.moonCount;this.ammoText.setText("Ammo: "+this.ammo);this.moonsText.setText("Moons: "+this.moonCount);this.setColliders()};d.xRand=function xRand(a){var b=2147483647&(this.player^this.banTime^this.seedTime)+this.tries;var c=1&(b>>30^b>>27^b>>6^b>>3);b=2147483647&(b<<1|c);return b%a};return b}(Phaser.Scene);

