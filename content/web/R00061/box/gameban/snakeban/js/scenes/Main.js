"use strict";function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}var Main=function(a){_inheritsLoose(b,a);function b(){var b;b=a.call(this,{key:"Main"})||this;b.group=null;b.player=null;b.banTime=null;b.seedTime=null;b.startTime=null;b.gamerOver=!1;b.speed=1;b.snake=null;b.apple=null;b.count=null;b.cursors=null;b.apples=0;b.calories=0;b.applesEaten=0;return b}var c=b.prototype;c.init=function init(a){this.group=a.group;this.player=a.player;this.banTime=a.banTime;this.seedTime=a.seedTime};c.create=function create(){var a=Math.floor;var b=this;var c=Math.round((this.banTime-this.seedTime)/3600);if(isNaN(c)||1>c){c=1}else if(100<c){c=100}this.calories=6-a(6*(c-1)/100);this.apples=Math.max(a((.05*(1>c?c:1)+.002*c)*768/this.calories),1);this.calories=Math.min(this.calories,6);var d=this.add.image(0,0,"bounds").setOrigin(0);this.count=this.add.dynamicBitmapText(96,32,"berlin","0/"+this.apples*this.calories,36).setOrigin(0);var e=new Button(this,this.cameras.main.width-38,38,"closeButton",closeGameBan);var f=this.add.dynamicBitmapText(this.cameras.main.centerX,this.cameras.main.centerY,"berlin","Eat "+this.apples+" apples to rejoin the chat!",116).setOrigin(.5);var g=this.tweens.timeline({tweens:[{targets:f,scale:.55,alpha:.55,ease:"Quad.easeInOut",duration:300},{targets:f,alpha:1,ease:"Quad.easeInOut",duration:400},{targets:f,delay:300,scale:7,alpha:.4,ease:"Quad.easeInOut",duration:300},{targets:f,scale:15,alpha:0,duration:150,ease:"Quad.easeInOut",onStart:function onStart(){b.startTime=Date.now()/1e3;b.snake=new Snake(b,9,9);b.apple=new Apple(b,0,0,b.snake.body)}}]});this.cursors=this.input.keyboard.createCursorKeys()};c.reset=function reset(){this.apple.reset();this.snake.body.destroy(!0);this.applesEaten=0;this.gamerOver=!1;this.snake=new Snake(this,9,9);this.apple=new Apple(this,0,0,this.snake.body);this.count.setText(this.applesEaten*this.calories+"/"+this.apples*this.calories)};c.update=function update(a,b){var c=Math.pow;var d=this;if(!this.snake||this.gamerOver)return;if(this.cursors.left.isDown){this.snake.faceLeft()}else if(this.cursors.right.isDown){this.snake.faceRight()}else if(this.cursors.up.isDown){this.snake.faceUp()}else if(this.cursors.down.isDown){this.snake.faceDown()}var e=this.snake.update(a,b);if(e){if(this.snake.collideWithApple(this.apple)){this.applesEaten++;this.count.setText(this.applesEaten*this.calories+"/"+this.apples*this.calories);if(this.applesEaten>=this.apples){this.gamerOver=!0;var f=document.getElementsByTagName("canvas")[0];var g=this.tweens.addCounter({from:0,to:1,duration:600,ease:"Quad.easeInOut",onUpdate:function onUpdate(){f.style.filter="blur("+40*g.getValue()+"px)";f.style.transform="scale("+(1+3*g.getValue())+")";f.style.opacity=1-g.getValue()},onComplete:function onComplete(){var a=new FormData;a.append("calories",d.calories);a.append("apples",d.apples);a.append("applesEaten",d.applesEaten);a.append("player",d.player);a.append("group",d.group);a.append("banTime",d.banTime);a.append("seedTime",d.seedTime);a.append("startTime",d.startTime);fetch("https://rxat.ro/web_gear/chat/snakeban2.php",{method:"POST",body:a}).then(function(a){return a.text()}).then(function(a){if(1==+a){closeGameBan()}else{location.reload()}}).catch(function(a){console.log("Error",a);location.reload()})}})}}if(this.snake.collideWithSelf()){this.gamerOver=!0;var h=this.add.dynamicBitmapText(this.cameras.main.centerX,this.cameras.main.centerY,"berlin","You ate yourself!",116).setOrigin(.5);var i=this.tweens.timeline({tweens:[{targets:h,scale:.55,alpha:.55,ease:"Quad.easeInOut",duration:300},{targets:h,alpha:1,ease:"Quad.easeInOut",duration:400},{targets:h,delay:300,scale:7,alpha:.4,ease:"Quad.easeInOut",duration:300},{targets:h,scale:15,alpha:0,duration:150,ease:"Quad.easeInOut",onStart:function onStart(){d.reset()}}]})}if(this.snake.collideWithBounds()){this.gamerOver=!0;var j=this.add.dynamicBitmapText(this.cameras.main.centerX,this.cameras.main.centerY,"berlin","You hit the wall!",116).setOrigin(.5);var k=this.tweens.timeline({tweens:[{targets:j,scale:.55,alpha:.55,ease:"Quad.easeInOut",duration:300},{targets:j,alpha:1,ease:"Quad.easeInOut",duration:400},{targets:j,delay:300,scale:7,alpha:.4,ease:"Quad.easeInOut",duration:300},{targets:j,scale:15,alpha:0,duration:150,ease:"Quad.easeInOut",onStart:function onStart(){d.reset()}}]})}var l=Math.sqrt(c(this.snake.head.x-this.apple.x,2)+c(this.snake.head.y-this.apple.y,2));if(l<=128){this.snake.stickTongue(!0)}else{this.snake.stickTongue(!1)}}};return b}(Phaser.Scene);

