"use strict";let page,tab,todo,Pin,GotLogin,DoneQuiz,url="https://rxat.ro/web_gear/chat/register4.php";document.body.style.backgroundColor="white",document.body.classList.remove("invisible"),$("#navGroup,#navxatApps").addClass("d-none"),Reset(),initConfig(),readUser(),setUser(),initLanguage(),initAuser3(),navClickHandlers(),startAnalytics(),setLoggedin(),legacyLinks(),cookieBar(),localize(["web","buy","login","mob1","mob2","quiz"]),fetchPromo(),setLogo(),location.hash.includes("app=")&&($("#promoframe").addClass("d-none"),$(".nav-tabs,.navbar-toggler,.pb-3").addClass("d-none"),$("h1").addClass("d-none"));let Common=$("#CommonDiv").html();$("#CommonDiv").html(""),$("#tablogin,#tablost,#tabchangename,#tabdelete,#tabgroup,#tabchangepass,#tablogout,#tabquiz").click((function(e){let a=e.currentTarget.id.substr(3);return DoTask(a),location.hash="#!"+a,!1})),AddClicks(),Pin=xInt(GET.params.Pin);let CheckReg,UserId=xInt(GET.params.UserId),k2=xInt(GET.params.k2),mode=xInt(GET.params.mode);function DoTask(e){switch(e){case"quiz":if(todo){doQuiz();break}case"lost":DoLost();break;case"logout":DoLogout();break;case"changepass":if(todo||GET.params.key){DoChangePass();break}case"changename":if(todo){DoChangeName();break}case"delete":if(todo){DoDelete();break}case"group":if(todo){ShowDialog(e);break}case"login":default:e="login",DoLogin()}SetTab(e)}function SetTab(e){e&&(page=e),$(".NavTabs").removeClass("active"),$("#tab"+page).addClass("active"),$("#lostemail").empty(),GotLogin?($("#loginlab").addClass("d-none"),$("#settingslab").removeClass("d-none")):($("#loginlab").removeClass("d-none"),$("#settingslab").addClass("d-none"))}function ShowDialog(e){$(".Dialog").addClass("d-none"),$("#"+e).removeClass("d-none")}function doQuiz(){ShowDialog("quiz")}function DoLogout(){$("#login").addClass("d-none"),$("#logout,#tablogout").removeClass("d-none")}function DoDelete(){$(".Dialog").addClass("d-none"),$("#delete").removeClass("d-none"),$("#DeleteName,#DeleteName2,#DeleteNameBut").text(todo.w_registered)}function DoChangeName(){ShowDialog("changename"),$("#ChangeName").text(todo.w_registered)}function DoChangePass(){allErrsOff(),ShowDialog("changepass"),todo&&$("#cpname").val(todo.w_registered),$("#cppass,#cppass1").val(""),$("#cpform").removeClass("d-none")}function LoggedIn(e){"logout"!=page?e?$("#LoginResult").html($("#LoginOk").html()):$("#LoginResult").html($("#LoginFailed").html()):$("#LoginResult").html("")}function DoSettings(e){let a=e.Err;if(todo=a.todo,SetNewTodo(todo),location.href.includes("app=")){let e=window.location.href;return e=e.split("direct"),void(window.location=e[0]+"box/embed.html?app=3")}a.Pin&&(Pin=xInt(a.Pin)),$("#regname").text(todo.w_registered+" ("+todo.w_userno+")"),window.location.href.indexOf("?flash")>-1?$("#embed").html(a.Settings):$("#embed").html(a.Settings2),$("#pro"+a.protect).prop("checked",!0),$("#ApiKey").text(a.ApiKey),$("#PowerAssignments").html(a.PowerAssignments),a.PowerAssignments?$("#tabgroup").removeClass("d-none"):$("#tabgroup").addClass("d-none"),$("#closewin").html($("#closewin").html().replace("%s","<br>")),$("#tabchangename,#tabdelete,#tabchangepass").removeClass("d-none"),$("#tablost").addClass("d-none"),GotLogin=1,ShowDialog("settings"),SetTab(),a.settings&&a.settings.indexOf(".needk2")>=0&&(e.Err.delsuccess='<span data-localize="web.delsuc">Account has been deleted</span>!'),DoErrs(e),localize(["web"])}function DoLogin(){if($("#embed").empty(),$("#tabregister").addClass("d-none"),GotLogin)ShowDialog("settings");else{ShowDialog("login");let e=$("#loginextra2");e.html()||(e.html(Common),$("#username,#password").keypress((function(e){return DoReturn(e)})),$("#passviewbut").off("click").click((function(e){PassReveal($(e.target))})))}}function DoReturn(e){return 13!=e.which||($("#lost").hasClass("d-none")?$("#login").hasClass("d-none")?$("#changename").hasClass("d-none")?$("#changepass").hasClass("d-none")||$("#butchangepass").click():$("#butchangename").click():$("#butlogin").click():$("#butlost").click(),!1)}function AddClicks(){$("#newname,#lostemail,#cpass1,#cpass2").keypress((function(e){return DoReturn(e)})),$(".PassReveal").click((function(e){PassReveal($(e.target))})),$("#butquiz").click((function(e){$("#tabquiz").removeClass("d-none"),DoTask("quiz"),loadQuiz()})),$("#butlogin,#butsettings,#butchangename,#butdelete,#butlost,#butregister,#butchangepass,#butlogout").click((function(e){e.preventDefault();let a=commonPost();if(a.NameEmail=a.YourEmail,Pin&&(a.Pin=Pin),todo&&(a.UserId=todo.w_userno),DoneQuiz&&(a.DoneQuiz=1),!$("#settings").hasClass("d-none")){switch($("input[name='protection']:checked").val()){case"1":a.Protected="OFF",a.Locked="OFF";break;case"2":a.Protected="ON",a.Locked="OFF";break;case"3":a.Protected="ON",a.Locked="ON"}$("#ResetApiKey").prop("checked")&&(a.ResetApiKey="ResetApiKey"),$("#DelMobs").prop("checked")&&(a.DelMobs="DelMobs")}$("#changepass").hasClass("d-none")?$("#changename").hasClass("d-none")?$("#delete").hasClass("d-none")?$("#logout").hasClass("d-none")?$("#lost").hasClass("d-none")?CheckReg?(CheckReg=0,a.UserId=UserId,a.k2=k2,a.mode=1,GET.params.ac&&(a.ac=GET.params.ac)):$("#register").hasClass("d-none")?a.Login=1:(a.Register=1,a.UserId=UserId,a.k2=k2,a.Username=$("#registername").val(),a["g-recaptcha-response"]=grecaptcha.getResponse(),a.agree=$("#registerterms").prop("checked")?"ON":0,a.password=$("#regpass").val(),a.password2=$("#regpass2").val(),a.email=$("#regemail").val(),xConfig.captoken&&(a.captoken=xConfig.captoken)):(a.ForgotPassword=1,a.NameEmail=$("#lostemail").val(),a["g-recaptcha-response"]=grecaptcha.getResponse()):a.Logout=1:(a.Delete=1,a.Username=$("#newname").val(),$("#DelMobs").prop("checked")&&(a.DelMobs="DelMobs")):(a.ChangeUserName=1,a.Username=$("#newname").val()):(a.ChangePassword=1,a.oldpassword=$("#cppass").val(),a.NameEmail=$("#cpname").val(),a.password=$("#cppass1").val(),a.password2=$("#cppass2").val(),GET.params.key&&(a.key=GET.params.key),a.UserId=GET.params.UserId),$(document.body).css({cursor:"wait"}),urlPost(url,a).then((function(e){if($(document.body).css({cursor:"default"}),allErrsOff(),$("#ResetApiKey").prop("checked",!1),$("#DelMobs").prop("checked",!1),e.Err.Settings)DoSettings(e);else{switch(e.Err.login?(e.Err.ClrHash&&todo&&(todo.PassHash="1",SetNewTodo(todo)),GotLogin=0,SetTab("login"),$(".NotLogin").addClass("d-none"),DoLogin()):e.Err.LogoutEmbed?($("#Logout1").addClass("d-none"),$("#Logout2").removeClass("d-none"),localStorage.clear(),clearCookies()):e.Err.lostok?($("#lostextra").addClass("d-none"),$("#lostcap").html("")):e.Err.ShowRegister&&($("#id").val(UserId),SetTab("register"),ShowDialog(page),$('[id^="tab"]').addClass("d-none"),$("#tabregister,#tablost,#tablogin").removeClass("d-none"),e.Err.captoken?(xConfig.captoken=e.Err.captoken,$("#registercap").addClass("d-none")):(AddCap("registercap"),xConfig.captoken=""),e.Err.regnoform&&$("#regform").addClass("d-none")),page){case"lost":e.Err.lostok||AddCap("lostcap");break;case"changepass":e.Err.changepassok&&(GotLogin=0,SetTab(),$("#cpform").addClass("d-none"))}DoErrs(e)}localize()}))}))}function DoLost(){Reset(),ShowDialog("lost"),AddCap("lostcap"),$("#lostextra").removeClass("d-none")}function loadQuiz(e=null){e=null==e?xConfig.lang:e,urlPost("//rxat.ro/json/translate/quiz-"+e+".php").then((function(e){if(null==e.quiz)return loadQuiz("en");var a=e.quiz,o=null,s=[],n=0;$.each(a,(function(e,a){isNaN(e.slice(-1))||"quizq"!=e.substr(0,5)||-1!=e.indexOf("a")?"quizq"==e.substr(0,5)&&e.indexOf("a")>-1&&"image"!==e.slice(-5)?s[o].answer.push([e,a].join(";")):"quizq"==e.substr(0,5)&&"info"==e.slice(-4)?s[o].info=a:"quizq"==e.substr(0,5)&&"image"==e.slice(-5)&&(s[o].image=a):(o=e.replace(/quizq/i,""),n++,s[o]={qID:parseInt(o),question:a,answer:[],info:"",image:""})})),$("#start_quiz").click((()=>{$("#start_quiz").hide(),$(".pro").removeClass("d-none"),loadQuestions(s,1,n)}))}))}function loadQuestions(e,a,o){var s=e[a],n=$("#quizForm"),t=$("#question_string"),r=$("#answers_list"),i=$("#question_image"),l=$("#next"),d={Err:{}},c=!1,g=10,u=$(".mainCountdown"),p=!1;if(a>o)updateProgress(a,o),p=!0,c=!0,n.hide(),d.Err.successmessage='<span data-localize="quiz.gratz">Congratulations, you have completed the quiz! You should now be more knowledgeable about safety on xat.</span>',d.Err.waitmessage='<span data-localize="quiz.redirect">Please wait while you are redirected to the login page.</span>',DoErrs(d),localize(["quiz"]),d={Err:{}},setTimeout((()=>{DoneQuiz=!0,SetTab("login"),$("#butsettings").click(),resetQuiz(o,n)}),5e3);else{t.html(s.question),""!=s.image&&i.html(s.image.replace("<br ","<"));var m="";for(var h in s.answer=shuffleArray(s.answer),s.answer){var b=s.answer[h].split(";");m+='<div class="form-check">\n               <input class="form-check-input position-static" type="radio" id="'+b[0]+'" name="qAnswer_'+s.qID+'" value="'+b[0]+'">\n               <label class="form-check-label" for="'+b[0]+'">'+b[1]+"</label>\n         </div>"}m+="</div>",r.html(m),n.hasClass("d-none")?n.removeClass("d-none"):n.show(),$("input[type=radio]").change((e=>{if(0==c&&0==p){allErrsOff();var n=e.target.id,t=parseInt(n.split("a")[1]);if(t%o<1||t%o>1)d.Err.wronganswer='<span data-localize="quiz.wronganswer">This is incorrect. Please try again.</span>';else{disableAnswers(),""!=s.info&&(d.Err.moreinfo="<span>"+s.info+"</span>"),$("#countdown").html(g);var r=setInterval((()=>{10==g?u.removeClass("d-none"):0==g?(clearInterval(r),a++,c=!0,u.addClass("d-none"),$("#countdown").html(10),l.removeClass("d-none"),l.prop("disabled",!1)):$("#countdown").html(""+g),g--}),1e3)}DoErrs(d),localize(["quiz"]),d={Err:{}}}})),l.click((()=>{allErrsOff(),0!=c&&(loadQuestions(e,a,o),updateProgress(a-1,o),c=!1,l.addClass("d-none"),l.prop("disabled",!0))}))}}function updateProgress(e,a){var o=$("#progress"),s=Math.round(e/a*100);o[0].style.cssText="width: "+s+"%",o.html(s+"%"),o.attr("aria-valuenow",s)}function disableAnswers(){$(".mainForm input[type=radio]").each((function(){$(this).attr("disabled",!0)}))}function resetQuiz(e,a){updateProgress(0,e),a.hide(),$(".pro").addClass("d-none"),$("#start_quiz").show()}1==mode&&(UserId||(UserId=xConfig.id),k2||(k2=xConfig.k2)),UserId&&k2&&GET.params.key?(DoTask("changepass"),$("#cpnouser").addClass("d-none")):UserId&&k2&&(1==mode||GET.params.ac)?(CheckReg=1,$("#butlogin").click()):DoTask(location.hash.substr(2));
