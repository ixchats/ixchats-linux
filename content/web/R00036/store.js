"use strict";let page,tab,tempFeature=[];document.body.style.backgroundColor="white",document.body.classList.remove("invisible"),$("#navGroup,#navxatApps").addClass("d-none"),Reset(),initConfig(),readUser(),setUser(),initLanguage(),initAuser3(),navClickHandlers(),startAnalytics(),setLoggedin(),legacyLinks(),cookieBar(),localize(["buy"]),fetchPromo(),setLogo();let Commom=$("#CommonDiv").html();function DoTask(e){switch(e){case"promotion":case"ads":DoPromo(e);break;case"group":DoBuyGroup();break;case"shortname":DoShortName();break;case"buyxats":DoBuyXats();break;case"auction":DoAuction();break;case"days2xats":doDx();break;case"xats2days":doX2d();break;case"powers":default:e="powers",DoBuyPowers(),updateTotalPrice(),doLoadCollections()}page=e,$(".NavTabs").removeClass("active"),$("#tab"+e).addClass("active")}function DoRelogin(e){let t=$("#username").val(),o=$("#password").val();Reset();e.Finished;for(let t in e)if("ReLogin"!=t&&"Finished"!=t){e=e[t];break}$("#relogin").removeClass("d-none"),$("#reloginerr").html(e),localize();let r=commonPost();r.NameEmail=t,r.password=o,r.Login=1,$(document.body).css({cursor:"wait"}),urlPost("https://rxat.ro/web_gear/chat/register3.php",r).then((function(e){$(document.body).css({cursor:"default"}),e.Err.todo&&localStorage.setItem("todo","{}"),SetNewTodo(e.Err.todo),$("#reloginflash").html(e.Err.Settings),$("#LoginResult").html("")}))}function DoAuction(){Reset(),$("#auction").removeClass("d-none"),$("#auctionextra").html()||$("#auctionextra").html(Commom),$("#auctionbut").off("click").click((function(e){e.preventDefault();let t=commonPost();if(!soltodo.w_registered)return $("#bid").css("display","none"),DoErrs({Err:{auction:"<span data-localize=buy.sorryyou>Sorry you must be a registered user to use auction</span>."}}),void localize();$("#username").val(soltodo.w_registered),$("#username").attr("disabled",!0),t.DesiredID=$("#DesiredID").val(),t.DesiredID&&(t.EnterBid=1),t.StartingBid=$("#StartingBid").val(),t.YourEmail=soltodo.w_registered,GET.params.old&&(t.old=1),$("#Transfer")&&(t.Transfer=$("#Transfer").val()),urlPost("https://rxat.ro/web_gear/chat/Auction2.php",t).then((function(e){if($(document.body).css({cursor:"default"}),allErrsOff(),DoErrs(e,"auction"),e.Err.TransferOpts){var t=document.getElementById("TransferOptserr"),o=document.getElementById("Transfer");o&&(o.classList+=" form-control mt-3"),t&&(t.innerHTML=t.innerHTML.replace(/<br>/gi," "))}let r;e.Err.auctiontable&&$(".bid").click(BidClicked),e.Err.auction||(r="#DesiredID"),e.Err.auctionchoose&&(r="#auctionchooseerr"),r&&$("html, body").animate({scrollTop:$(r).offset().top}),localize()}))})).trigger("click")}function BidClicked(e){let t=$(e.target).data();$("#StartingBid").val(t.bid),$("#DesiredID").val(t.id)}function DoBuyXats(){if(Reset(),$("#buyxats").removeClass("d-none"),GET.params.c)return void $("#buythanks").removeClass("d-none");if($("#buyform").html())return;let e=commonPost();if(!soltodo.w_registered)return DoErrs({Err:{buyxats:"<span data-localize=buy.sorryyouBuy>Sorry you must be a registered user to buy xats and days</span>."}}),void localize();e.UserId=soltodo.w_userno,urlPost("https://rxat.ro/web_gear/chat/buy2.php",e).then((function(e){$(document.body).css({cursor:"default"}),allErrsOff(),e.Err.buytable&&($("#buyform").html(e.Err.buytable),$("#abouttobuy").removeClass("d-none"),$("#buyuser").text(soltodo.w_registered+" ("+soltodo.w_userno+")")),DoErrs(e,"buyxats"),localize()}))}var Sections3;function DoBuyPowers(){Reset(),Sections3=["Featured","Standard","Rare","Epic","Group","Games","Collection","All"],tab="Featured",$("#powers").removeClass("d-none"),$(".PowTabs").removeClass("active"),$("#bpFeatured").addClass("active"),$("#buypowersextra").html(Commom),preSetUsername();let e="https://rxat.ro/web_gear/chat/GetPowers2.php";$("#buypowersbut").off("click").click((function(t){t.preventDefault();let o=commonPost();$("input[name^=pnum]").each((function(e){$(this).val()&&(o[$(this).prop("name")]=$(this).val())})),$("input[name^=pchk]").each((function(e){let t="pnum"+$(this).prop("name").substr(4);$(this).prop("checked")&&o[t]<1&&(o[t]=1)})),$(document.body).css({cursor:"wait"}),urlPost(e,o).then((function(e){$(document.body).css({cursor:"default"}),allErrsOff(),e.Err.ReLogin?DoRelogin(e.Err):(DoErrs(e,"buypowers"),"Collection"!==tab&&configureStorePage(tab,0,e.Err.remaining),localize())}))})),urlPost("https://rxat.ro/json/powers.php").then((function(t){urlPost(e,{update:1}).then((function(e){configureStorePage(tab,t,e.Err.remaining)}))}));let t="";for(let e in Sections3)t+=",#bp"+Sections3[e];$(t.substr(1)).off("click").click((function(e){tab=e.currentTarget.id.substr(2),"Collection"!==tab&&($(".PowTabs").removeClass("active"),$("#bp"+tab).addClass("active"),configureStorePage(tab))})),$("#morebut").off("click").click((()=>{let e=document.getElementById("searchopts");e.style.display="none"==e.style.display||""==e.style.display?"block":"none",getFilter()})),$(window).off("click").click((e=>{if(!e.target.matches("#morebut")){let e=document.getElementById("searchopts");"block"==e.style.display&&(e.style.display="none")}})),document.querySelectorAll("[data-option='true']").forEach((e=>{e.addEventListener("click",(()=>{let t=[];Sorting=e.id,"clear"==e.id&&$("#search").val(""),"object"==typeof PowerObj&&(t=$.map(PowerObj,(function(e,t){let o=e;return o.id=t,o})),$('input[name="save_filter"]').is(":checked")&&setFilter(Sorting),t=Object.keys(tempFeature).length>0&&"Featured"==tab?tempFeature:t,sortPowers(t),addPowers(t))}))})),$('input[name="save_filter"]').on("change",(function(){$(this).is(":checked")?setFilter(Sorting):(setFilter(""),$(this).prop("checked",!1))})),$(document).on("keyup click","input[name^=pnum]",(function(e){var t=parseInt(e.target.name.replace("pnum","")),o=e.target.value;$.each(Powers,(function(e,r){null!=r&&r.id==t&&(r.quantityStore=0==o&&$("input[name=pchk"+t+"]").is(":checked")?1:o,updateTotalPrice())}))})),$(document).on("click","input[name^=pchk]",(function(){var e=parseInt($(this)[0].name.replace("pchk","")),t=!!$(this).is(":checked"),o=$('input[name="pnum'+e+'"]').val();$.each(Powers,(function(r,a){null!=a&&a.id==e&&(a.s,a.checked=t,a.quantityStore=t&&0==o?1:o,updateTotalPrice())}))})),$("#search").keyup((()=>{let e=[],t=$("#search").val().toLowerCase();for(let o in PowerObj)PowerObj.hasOwnProperty(o)&&(PowerObj[o].s.substring(0,t.length)==t||PowerObj[o].s.indexOf(t)>0)&&("Featured"==tab?(1!=PowerObj[o].r||4096&PowerObj[o].f)&&e.push(PowerObj[o]):e.push(PowerObj[o]));if(e.length>0&&t.length>0)addPowers(e);else if(t.length>0){var o=document.getElementById("powerslist");o.innerHTML="";let e=makeElement(o,"span","textInfo");addText(e,["buy.nopowers","No powers found."])}else configureStorePage(tab)}))}$("#CommonDiv").html(""),GET.hash&&0==GET.params.length&&(location.hash="#"+GET.hash),$("#tabshortname,#tabpromotion,#tabads,#tabpowers,#tabgroup,#tabbuyxats,#tabauction,#tabdays2xats,#tabxats2days").click((function(e){let t=e.currentTarget.id.substr(3);return DoTask(t),location.hash="#!"+doRealHash(location.hash,t),!1})),DoTask(getRealHash()),$(window).width()<992&&($(".showrules").addClass("collapse multi-collapse"),$(".showtrigger").removeClass("d-none"));let Sorting="";function sortPowers(e){switch(Sorting=""==Sorting&&"Featured"!=tab?getFilter():Sorting,Sorting.toLowerCase()){case"sort_az":e.sort(((e,t)=>e.s>t.s?1:t.s>e.s?-1:0));break;case"sort_za":e.sort(((e,t)=>e.s>t.s?-1:t.s>e.s?1:0));break;case"sort_19":e.sort(((e,t)=>xInt(e.id)>xInt(t.id)?1:xInt(t.id)>xInt(e.id)?-1:0));break;case"sort_91":e.sort(((e,t)=>xInt(e.id)>xInt(t.id)?-1:xInt(t.id)>xInt(e.id)?1:0));break;case"sort_price_asc":e.sort(((e,t)=>{let o=e.x?xInt(e.x):13.5*xInt(e.d),r=t.x?xInt(t.x):13.5*xInt(t.d);return o>r?1:r>o?-1:0}));break;case"sort_price_desc":e.sort(((e,t)=>{let o=e.x?xInt(e.x):13.5*xInt(e.d),r=t.x?xInt(t.x):13.5*xInt(t.d);return o>r?-1:r>o?1:0}))}}function DoRemaing(e){e.Err.remaining}let Lang="";function DoPromo(e){Reset(),"ads"==e?$(".AdDiv").removeClass("d-none"):$(".PromoDiv").removeClass("d-none"),$("#promoextra").html(Commom),preSetUsername(),$("#promohoursdiv").removeClass("d-none"),$("#adcostbut,#promobut,#authbut,#adbut").off("click").click((function(e){e.preventDefault();let t=commonPost();switch(t.GroupName=$("#promoname").val(),t.XatsDays=$("input[name=XatsDays]:checked").val(),t.Hours=Math.max($("#promohours").val(),.5),t.Xats=$("#promoxats").text(),t.Days=$("#promodays").text(),t.AdImg=$("#adimage").val(),t.Lang=Lang,e.currentTarget.id){case"adcostbut":"ads"==page?t.Quote2=1:t.Quote=1;break;case"promobut":t.Promote=1;break;case"authbut":t.Authorize=1;break;case"adbut":t.Advertise=1}$(document.body).css({cursor:"wait"}),urlPost("https://rxat.ro/web_gear/chat/promotion2.php",t).then((function(e){if($(document.body).css({cursor:"default"}),allErrsOff(),e.Err.Finished)DoRelogin(e.Err);else{if(DoErrs(e,"promotion"),$("#promohours").val(e.Hours),$("#promolangdiv").addClass("d-none"),$("#promobutdiv").addClass("d-none"),$("#promoname").val(e.promoname),$("#promoextra").addClass("d-none"),$("#promocostdiv")[0].scrollIntoView(),e.Xats){$("#promocostdiv").removeClass("d-none");let t=0;e.Err.adimage||e.Err.promoname||($("#promoextra").removeClass("d-none"),t=1),Lang=e.Lang,Lang&&e.Language&&($("#promolangdiv").removeClass("d-none"),$("#promolang").text(e.Language)),"ads"==page?e.NeedApproval?($("#promocostdiv").addClass("d-none"),$("#adauth").removeClass("d-none"),$("#authbut")[0].scrollIntoView()):($("#adauth").addClass("d-none"),t&&($("#adbutdiv").removeClass("d-none"),$("#adbutdiv")[0].scrollIntoView())):t&&($("#promobutdiv").removeClass("d-none"),$("#promobutdiv")[0].scrollIntoView()),$("#promoxats").text(e.Xats),$("#promodays").text(e.Days)}localize()}}))}))}function DoBuyGroup(){Reset(),$("#group").removeClass("d-none"),$("#buygroupextra2").html(Commom),preSetUsername(),$("#getcost,#butbuygroup").off("click").click((function(e){e.preventDefault();let t=commonPost();t.GroupName=$("#wantedgroup").val(),t.Xats=$("#groupxats").text(),"butbuygroup"===e.currentTarget.id?t.Promote=1:t.Quote=1,$(document.body).css({cursor:"wait"}),urlPost("https://rxat.ro/web_gear/chat/TransferGroup2.php",t).then((function(e){$(document.body).css({cursor:"default"}),allErrsOff();let t=$("#buygrouperr");e.Err.ReLogin?DoRelogin(e.Err):(e.Err.buygroup&&e.Err.Finished?doSuccessMsg(t,e.Err.buygroup):DoErrs(e,"buygroup"),$("#groupxats").text(e.Xats),$("#buygroupname").text(e.wantedgroup),$("#wantedgroup").val(e.wantedgroup),e.Xats?($("#buygroupextra").removeClass("d-none"),$("#butbuygroup")[0].scrollIntoView()):$("#buygroupextra").addClass("d-none"),localize())}))})),$("#wantedname").keypress((function(e){if(13==e.which)return $("#getcost").off("click").click(),!1}))}function DoShortName(){Reset(),$("#shortname").removeClass("d-none"),$("#shortnameextra2").html(Commom),preSetUsername(),$("#getcost,#buyshortname").off("click").click((function(e){e.preventDefault();let t=commonPost();t.GroupName=$("#wantedname").val(),t.CheckAny=GET.params&&GET.params.CheckAny||0,t.Xats=$("#shortxats").text(),"buyshortname"===e.currentTarget.id?t.Promote=1:t.Quote=1,$(document.body).css({cursor:"wait"}),urlPost("https://rxat.ro/web_gear/chat/BuyShortName2.php",t).then((function(e){$(document.body).css({cursor:"default"}),allErrsOff(),e.Err.ReLogin?DoRelogin(e.Err):(DoErrs(e,"buyshortname"),$("#shortxats").text(e.Xats),$("#buygroupname").text(e.wantedname),$("#wantedname").text(e.wantedname),e.Xats?($("#shortnameextra").removeClass("d-none"),$("#buyshortname")[0].scrollIntoView()):$("#shortnameextra").addClass("d-none"),localize())}))})),$("#wantedname").keypress((function(e){if(13==e.which)return $("#getcost").off("click").click(),!1}))}var NonMobs,LangFiles,PowersHead,PowerObj,LatestPower,tmpPowers,Powers=[],Sections={New:1e6,Standard:0,Rare:-4e5,Epic:-6e5},Sections2=["New","Standard","Rare","Epic"],CurrentSec="New",LineVisible=0;function configureStorePage(e,t,o){if("Collection"!=e&&t&&(tmpPowers=t),t?PowerObj=t:t=tmpPowers,o)for(let e in o)t[o[e].id]&&(t[o[e].id].r=o[e].remaining);if(LatestPower=0,"object"==typeof t)switch(Powers=$.map(t,(function(e,t){let o=e;return o.id=t,o})),e){case"All":Powers.sort((function(e,t){return t.a-e.a}));break;case"Featured":Powers.sort((function(e,t){return t.id-e.id}));break;default:Powers.sort((function(e,t){return StorePoints(t)-StorePoints(e)}))}sortPowers(Powers),addPowers(Powers)}function addPowers(e){let t={};tempFeature=[],$("input[name^=pnum]").each((function(e){$(this).val()>0&&(t[$(this).prop("name").substr(4)]=$(this).val())})),$("input[name^=pchk]").each((function(e){$(this).prop("checked")&&(t[$(this).prop("name").substr(4)]=1)}));var o=document.getElementById("powerslist");PowersHead||(PowersHead=$("#powerslist2").html()),o.innerHTML="",o.classList.remove("d-none");let r=makeElement(o,"table","table table-bordered table-sm table-responsive d-block d-md-table"),a=makeElement(r,"thead");makeElement(a,"tr").innerHTML=PowersHead;var n,s=0;for(var i in e){if(void 0===e[i])continue;if(n=e[i].id,NonMobs&&NonMobs[n>>5]&1<<n%32)continue;if(!t[n])if("Featured"==tab){if(1==e[i].r&&!(4096&e[i].f))continue;if(s++>12)continue;tempFeature.push(e[i])}else if(e[i].sec&&!e[i].sec[tab]&&"All"!=tab)continue;let o=makeElement(r,"tbody"),a=makeElement(o,"tr");e[i].r>0&&(a.style.cssText="background-color:#f8f9fa");let l=makeElement(a,"td"),c=e[i].d1;if(1==e[i].r?c+='<br><span class="unavailable" data-localize="buy.trytrading">Unavailable, try <a href="//rxat.ro/web_gear/chat/chats.php?type=trade">trading</a></span>':e[i].r>1&&(c='<a title="'+e[i].s+' <span data-localize=buy.unavailable>will be temporarily unavailable when sold out</span>">'+c+"</a>",c+='<b><BR><font color="#ff0000">'+(e[i].r-1)+" <span data-localize=buy.remaining>remaining!</span></font></b>",64&e[i].f&&(c+='<b><BR><font color="#ff0000"> <span data-localize=buy.willdrop>PRICE WILL DROP!</span></font></b>')),l.innerHTML=c,"Featured"==tab){let t=makeElement(a,"td");4096&e[i].f&&(t.innerHTML='<img src="'+xConfig.dir+'img/navbar/new.svg" width="50" alt="new"/>'),t.style.textAlign="center"}else{let e=document.querySelector("#newCol");e&&e.parentNode.removeChild(e)}let u=makeElement(a,"td");u.style.textAlign="center";let d=makeElement(u,"img");d.src="https://rxat.ro/images/smw/"+e[i].s+".png",d.alt=""+e[i].s,d.style.display="block",d.style.margin="0 auto",d.style.cursor="pointer";let m="https://xat.wiki/"+e[i].s;d.addEventListener("click",(function(){window.open(m,"_blank")})),addText(u,"("+e[i].s+")");let p=makeElement(a,"td");p.style.textAlign="center";let f=makeElement(a,"td");f.style.textAlign="center";let b=makeElement(a,"td");b.style.textAlign="center";let h="";if(1!=e[i].r){h=e[i].x,h=h>1?[["",h+" "],["mob1.xats","xats"]]:[["",e[i].d+" "],["mob1.days","days"]],e[i].cost=h,addText(p,h);let o=t[e[i].id],r=makeElement(f,"input");r.name="pnum"+e[i].id,r.type="number",r.size=3,r.min=0,r.value=o>1?o:0,r.className="xInput num";let a=makeElement(b,"input");a.name="pchk"+e[i].id,a.type="checkbox",a.value="ON",a.checked=1==o}let g=makeElement(a,"td"),y=e[i].d2;$(window).width()<992&&(y=y.replace(y,"$WIKIP")),y=y.replace("$WIKIP",'See <a target="_blank" rel="noopener" href="https://xat.wiki/'+e[i].s+'">wiki for details</a>'),y=y.replace("$WIKI",'See <a target="_blank" rel="noopener" href="https://xat.wiki/'+e[i].s+'">wiki for details</a>'),y=y.replace('<a href="https://xat.wiki/Powers">','<a target="_blank" rel="noopener" href="https://xat.wiki/'+e[i].s+'">'),y=y.replace("http:","https:"),g.innerHTML=y}localize(["buy"])}function StoreSection(e,t){var o=document.createElement("div");return o.setAttribute("id",t),e.appendChild(o),o}function StorePoints(e){if(null==e)return-1e9;if(e.sec&&e.sec[tab])return e.sec[tab];let t=AlphaValue(e.s);var o=parseInt(e.f);e.sec={};let r=!0;return e.id>LatestPower-10&&(e.sec.Featured=e.id+Sections.New),8&o&&(e.sec.Epic=parseInt(e.x),r=!1),128&o&&(e.sec.Games=t,r=!1),2048&o&&(e.sec.Group=t,r=!1),8192&o&&(e.sec.Rare=t,r=!1),r&&(e.sec.Standard=t),e.c&&(e.sec.Collection=t),e.a=t,e.sec[tab]?e.sec[tab]:0}function AlphaValue(e){for(var t,o=0,r=0;r<3;r++)o*=256,(t=e.charCodeAt(r))&&(o+=t);return-o}function getFilter(){let e;try{e=localStorage.getItem("store_filter")}catch(e){}return e=e?JSON.parse(e):"",0!=e&&(e.store_value?(e=e.store_value,$("#save_filter").prop("checked",!0)):e=""),updateFilterColor(e,""),e}function setFilter(e){var t={store_value:e},o=getFilter();localStorage.setItem("store_filter",JSON.stringify(t)),updateFilterColor("clear"==e?"":e,o)}function updateFilterColor(e,t){""!=e&&$("#"+e).css("background-color","#007bff14"),""!=t&&$("#"+t).css("background-color","")}function updateTotalPrice(){var e=0,t=0,o={};$.each(Powers,(function(o,r){null!=r&&(null!=r.checked&&1==r.checked||null!=r.quantityStore&&r.quantityStore>=1)&&(r.x?e+=parseInt(r.x)*r.quantityStore:t+=parseInt(r.d)*r.quantityStore)})),(e>0||t>0)&&(o={Err:{powersTotal:'<span data-localize="web.totalprice">Total price: </span> '+[e.toLocaleString()+" xats",t.toLocaleString()+" days"].join(", ")}}),Object.keys(o).length>0?(DoErrs(o,"buypowers"),localize()):allErrsOff()}function doDx(){Reset(),$("#days2xats").removeClass("d-none"),$("#days2xatsextra2").html(Commom),preSetUsername();$("#days2xatsbut").off("click").click((function(e){e.preventDefault();let t=commonPost(),o=$("#NoOfDays").val();t.NoOfDays=o,t.Convert=1,$(document.body).css({cursor:"wait"}),urlPost("https://rxat.ro/web_gear/chat/DaysToXats2.php",t).then((function(e){$(document.body).css({cursor:"default"}),allErrsOff(),e.Err.ReLogin?DoRelogin(e.Err):DoErrs(e,"days2xats")}))}))}function doX2d(){Reset(),$("#xats2days").removeClass("d-none"),$("#xats2daysextra2").html(Commom),preSetUsername();$("#xats2daysbut").off("click").click((function(e){e.preventDefault();let t=commonPost(),o=$("#NoOfXats").val();t.NoOfXats=o,t.Convert=1,$(document.body).css({cursor:"wait"}),urlPost("https://rxat.ro/web_gear/chat/XatsToDays2.php",t).then((function(e){$(document.body).css({cursor:"default"}),allErrsOff(),e.Err.ReLogin?DoRelogin(e.Err):DoErrs(e,"xats2days")}))}))}function preSetUsername(){if(void 0===xConfig||void 0===xConfig.username||!xConfig.username.length)return!1;let e=document.getElementById("username");e&&(e.value=xConfig.username,e.disabled=!0)}function doLoadCollections(){urlPost("/web_gear/chat/pow2.php").then((function(e){let t=e[10][1],o={0:{s:"allpowers",d1:"AllPowers",d2:"Exclusive abilities. To qualify for allpowers you need to buy the 170 required powers. $WIKI",x:0,r:1,f:12290,c:1},127:{s:"everypower",d1:"EveryPower",d2:"Sparkling Emerald pawn. To qualify for everypower you need every single xat power. $WIKI",x:0,r:1,f:12290,c:1}};for(let e in t){let r=t[e].s.split(","),a=t[e].n.split(",");o[e]={s:r[0],d1:ucfirst(r[0].replace("super",""))+" Collection",d2:ucfirst(r[0].replace("super",""))+" themed collection. Requires "+a.length+" powers. $WIKI",x:0,r:1,f:12290,c:1}}$("#bpCollection").click((()=>{$(".PowTabs").removeClass("active"),$("#bpCollection").addClass("active"),configureStorePage("Collection",o)}))}))}function ucfirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}$(".noread1, .noread2, .noread3, .noread4, .noread5, .noread6").attr("readonly",!0),$(".noread1, .noread2, .noread3, .noread4, .noread5, .noread6").css("background-color","white"),$(".noread1, .noread2, .noread3, .noread4, .noread5, .noread6").click((function(){$(this).attr("readonly",!1)}));
