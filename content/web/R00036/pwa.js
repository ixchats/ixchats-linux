var _JSON$parse;let xjson=document.getElementById("xjson");xjson=JSON.parse(xjson.innerHTML);let jdir=xjson.dir;var deferredPrompt;function PWAinstall(){if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){let e=window.open("https://xat.wiki/pwa");e&&e.focus()}else deferredPrompt&&(deferredPrompt.prompt(),deferredPrompt.userChoice.then((e=>{e.outcome,deferredPrompt=null})))}function appMode(){document.body.innerHTML='<iframe src="'+jdir+"box/embed.html#!&app=1&n="+xjson.g+'" class="embediframe"></iframe>'}function directMode(){loadStyles("https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css").then((e=>loadStyles(jdir+"direct.css"))).then((e=>fetch(jdir+"direct.html").then((e=>e.text())).then((e=>{e=e.replace(/\.\.\/src\//g,jdir);const t=new DOMParser;document.body.appendChild(t.parseFromString(e,"text/html").body.firstChild)})))).then((e=>loadScript("https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"))).then((e=>Promise.all([loadScript("https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.bundle.min.js"),loadScript("https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.6/handlebars.runtime.js"),loadScript("https://www.google-analytics.com/urchin.js").catch((e=>console.info("Failed to load GA",e))),loadScript(jdir+"common.js")]))).then((e=>loadScript(jdir+"lib/jquery.localize.js"))).then((e=>loadScript(jdir+"direct.js")))}function loadScript(e){return new Promise((function(t,r){const o=document.createElement("script");o.async=!0,o.src=e,o.onload=t,o.onerror=r,document.head.appendChild(o)}))}function loadStyles(e){return new Promise((function(t,r){const o=document.createElement("link");o.rel="stylesheet",o.href=e,o.onload=t,o.onerror=r,document.head.appendChild(o)}))}"serviceWorker"in navigator&&window.addEventListener("load",(function(){let e=jdir.split("/");e=e[e.length-2],navigator.serviceWorker.register("/sw"+e+".js").then((function(e){}),(function(e){console.log("ServiceWorker registration failed: ",e)}))})),window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),window.location.href.search("PWA=1")>0||(deferredPrompt=e)})),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|BB10|Silk|Mobi/i.test(navigator.userAgent)&&"enable"!=(null==(_JSON$parse=JSON.parse(localStorage.getItem("Settings")))?void 0:_JSON$parse.classic)?appMode():directMode();