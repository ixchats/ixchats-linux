class Xavi{constructor(){this.xConfig={name:"Xavi Editor",channel:20047,origin:"https://rxat.ro",version:6152020},this.cb=null,this.sv=null,this.WY=null,this.xavi=209,this.userId=0,this.loaded=!1,this.xaviCode=null,this.xaviFrame=null,this.DebugMode=!1,this.connected=!1,this.currentTab=null,this.favorites=[],this.pssa=null,this.pssh=null,this.MAXPOWER=0,this.powers=null,this.w_Powers=null,this.w_PowerO=null,this.elements={head:{head0:{x:0,y:0,sx:1,sy:1,r:0,power:24},head1:{x:0,y:0,sx:1,sy:1,r:0,set:1},head2:{x:0,y:0,sx:1,sy:1,r:0,set:1},head3:{x:0,y:1,sx:1,sy:1,r:0,set:1},head4:{x:0,y:-1,sx:1,sy:1,r:0,set:1},head5:{x:0,y:1,sx:1,sy:1,r:0,set:1},head6:{x:0,y:-.5,sx:1,sy:1,r:0,set:1},head7:{x:0,y:-.5,sx:1,sy:1,r:0,set:1},head8:{x:0,y:-.5,sx:1,sy:1,r:0,set:1},head9:{x:0,y:-.5,sx:1,sy:1,r:0,set:1}},hair:{hair0:{x:0,y:0,sx:1,sy:1,r:0,set:1},hair1:{x:0,y:-8,sx:1,sy:1,r:0,set:1},hair2:{x:0,y:-5.5,sx:1,sy:1,r:0,set:1},hair3:{x:0,y:-7,sx:1,sy:1,r:0,set:1},hair4:{x:-3,y:7,sx:1,sy:1,r:0,set:1},hair5:{x:.5,y:5.5,sx:1,sy:1,r:0,set:1},hair7:{x:0,y:0,sx:1,sy:1,r:0,set:1},hair6:{x:0,y:-6,sx:1,sy:1,r:0,set:1},hair8:{x:-1.3,y:0,sx:1,sy:1,r:0,set:1},hair9:{x:0,y:0,sx:1,sy:1,r:0,set:1},hair10:{x:0,y:8,sx:1,sy:1,r:0,set:2},hair11:{x:0,y:-8,sx:1,sy:1,r:0,set:2},hair12:{x:0,y:-5,sx:1,sy:1,r:0,set:2},hair13:{x:-2,y:-3,sx:1,sy:1,r:0,set:2},hair14:{x:0,y:-5,sx:1,sy:1,r:0,set:2},hair15:{x:-.75,y:-6,sx:1,sy:1,r:0,set:2},hair16:{x:-.5,y:-6,sx:1,sy:1,r:0,set:2},hair17:{x:0,y:-2,sx:1,sy:1,r:0,set:2},hair18:{x:0,y:-3,sx:1,sy:1,r:0,set:2},hair19:{x:-4,y:-3,sx:1,sy:1,r:0,set:2},hair20:{x:-.6,y:-5,sx:1,sy:1,r:0,set:3},hair21:{x:0,y:-4.5,sx:1,sy:1,r:0,set:3},hair22:{x:0,y:-6,sx:1,sy:1,r:0,set:3},hair23:{x:-1,y:-6,sx:1,sy:1,r:0,set:3},hair24:{x:0,y:-3,sx:1,sy:1,r:0,set:3},hair25:{x:0,y:-9,sx:1,sy:1,r:0,set:3},hair26:{x:0,y:-3,sx:1,sy:1,r:0,set:3},hair27:{x:0,y:-3,sx:1,sy:1,r:0,set:3},hair28:{x:0,y:-9,sx:1,sy:1,r:0,set:1,power:393},hair29:{x:-2,y:-7,sx:1,sy:1,r:0,set:1,power:408},hair30:{x:0,y:-5,sx:1,sy:1,r:0,set:1,power:524},hair31:{x:1,y:-2,sx:1,sy:1,r:0,set:1,power:524},hair32:{x:-3,y:-2,sx:1,sy:1,r:0,set:1,power:524},hair33:{x:0,y:-3,sx:1,sy:1,r:0,set:1,power:524},hair34:{x:.5,y:-2,sx:1,sy:1,r:0,set:1,power:524},hair35:{x:0,y:0,sx:1,sy:1,r:0,set:1,power:524}},items:{items0:{x:0,y:0,sx:1,sy:1,r:0,set:1},items1:{x:0,y:-7.5,sx:1,sy:1,r:0,set:1},items2:{x:0,y:12,sx:1,sy:1,r:0,set:1},items3:{x:0,y:0,sx:1,sy:1,r:0,set:1},items4:{x:0,y:0,sx:1,sy:1,r:0,set:1},items5:{x:0,y:0,sx:1,sy:1,r:0,set:1},items6:{x:-5,y:8,sx:1,sy:1,r:0,set:1},items7:{x:0,y:7.5,sx:1,sy:1,r:0,set:1},items8:{x:0,y:0,sx:1,sy:1,r:0,set:1},items9:{x:0,y:0,sx:1,sy:1,r:0,set:1},items10:{x:0,y:0,sx:1,sy:1,r:0,set:1},items11:{x:0,y:14,sx:1,sy:1,r:0,set:1},items12:{x:-2,y:-13,sx:1,sy:1,r:0,set:1},items13:{x:-2,y:-7,sx:1,sy:1,r:0,set:1},items14:{x:4,y:-7,sx:1,sy:1,r:0,set:1},items15:{x:-1,y:-9.6,sx:1,sy:1,r:0,set:1},items16:{x:0,y:0,sx:1,sy:1,r:0,behind:!0,power:393},items17:{x:0,y:3,sx:1,sy:1,r:0,behind:!0,power:393},items31:{x:3,y:-19,sx:1,sy:1,r:0,power:393},items18:{x:0,y:-12,sx:1,sy:1,r:0,power:524},items19:{x:0,y:0,sx:1,sy:1,r:0,power:517},items20:{x:0,y:0,sx:1,sy:1,r:0,power:517},items21:{x:0,y:0,sx:1,sy:1,r:0,power:517},items22:{x:0,y:0,sx:1,sy:1,r:0,power:517},items23:{x:0,y:0,sx:1,sy:1,r:0,power:517},items24:{x:0,y:0,sx:1,sy:1,r:0,power:517},items25:{x:0,y:0,sx:1,sy:1,r:0,power:517},items26:{x:0,y:0,sx:1,sy:1,r:0,power:517},items27:{x:0,y:0,sx:1,sy:1,r:0,power:517},items28:{x:0,y:0,sx:1,sy:1,r:0,power:517},items29:{x:0,y:0,sx:1,sy:1,r:0,power:517},items30:{x:0,y:0,sx:1,sy:1,r:0,power:517},items32:{x:0,y:-12,sx:1,sy:1,r:0,set:2},items33:{x:0,y:-11,sx:1,sy:1,r:0,set:2},items34:{x:.5,y:-4,sx:1,sy:1,r:0,set:2},items35:{x:-.5,y:-1,sx:1,sy:1,r:0,set:2},items36:{x:1,y:0,sx:1,sy:1,r:0,set:2},items37:{x:1.5,y:13.5,sx:1,sy:1,r:0,set:2},items38:{x:3,y:-12,sx:1,sy:1,r:0,set:2},items39:{x:0,y:0,sx:1,sy:1,r:0,set:2},items40:{x:0,y:-15,sx:1,sy:1,r:0,set:2},items41:{x:0,y:9.5,sx:1,sy:1,r:0,set:2},items42:{x:-.5,y:-12,sx:1,sy:1,r:0,set:2},items43:{x:-3,y:-2,sx:1,sy:1,r:0,set:2},items44:{x:0,y:0,sx:1,sy:1,r:0,set:2},items45:{x:2.1,y:16.5,sx:1,sy:1,r:0,set:3},items46:{x:0,y:-13,sx:1,sy:1,r:0,set:3},items47:{x:-.7,y:0,sx:1,sy:1,r:0,set:3},items48:{x:0,y:0,sx:1,sy:1,r:-30,set:3},items49:{x:0,y:0,sx:1,sy:1,r:0,behind:!0,set:3},items50:{x:0,y:10,sx:1,sy:1,r:0,set:3},items51:{x:-12,y:0,sx:1,sy:1,r:0,set:3},items52:{x:0,y:13,sx:1,sy:1,r:0,set:3},items53:{x:0,y:13,sx:1,sy:1,r:0,set:3},items54:{x:2,y:10,sx:1,sy:1,r:0,set:3},items55:{x:0,y:13,sx:1,sy:1,r:0,set:3},items56:{x:-9,y:0,sx:1,sy:1,r:0,set:3},items57:{x:-1.5,y:-8,sx:1,sy:1,r:0,set:3},items58:{x:0,y:15,sx:1,sy:1,r:0,set:4},items59:{x:-10,y:7,sx:1,sy:1,r:-18,set:4},items60:{x:0,y:12,sx:1,sy:1,r:0,set:4},items61:{x:0,y:10,sx:1,sy:1,r:-30,set:4},items62:{x:0,y:16,sx:1,sy:1,r:0,set:4},items63:{x:0,y:9.5,sx:1,sy:1,r:0,set:4},items64:{x:0,y:13,sx:1,sy:1,r:0,set:4},items65:{x:-8,y:7,sx:1,sy:1,r:0,set:4},items66:{x:0,y:-13,sx:1,sy:1,r:0,set:4},items67:{x:2.45,y:-8.55,sx:1,sy:1,r:-5,set:4},items68:{x:0,y:10,sx:1,sy:1,r:0,set:4},items69:{x:0,y:15,sx:1,sy:1,r:0,set:4},items70:{x:-7,y:10,sx:1,sy:1,r:0,set:4}},eyes:{eyes1:{x:0,y:0,sx:1,sy:1,r:0,set:1},eyes2:{x:0,y:0,sx:1,sy:1,r:0,set:1},eyes3:{x:0,y:0,sx:1,sy:1,r:0,set:2},eyes4:{x:0,y:1.5,sx:1,sy:1,r:0,set:2},eyes5:{x:0,y:0,sx:1,sy:1,r:0,set:2},eyes6:{x:0,y:0,sx:1,sy:1,r:0,set:2},eyes7:{x:0,y:0,sx:1,sy:1,r:0,set:2},eyes8:{x:0,y:0,sx:1,sy:1,r:0,set:3},eyes9:{x:0,y:-1.5,sx:1,sy:1,r:0,set:3},eyes10:{x:0,y:-.5,sx:1,sy:1,r:0,set:3},eyes11:{x:0,y:0,sx:1,sy:1,r:0,set:3}},mouth:{mouth1:{x:0,y:8.8,sx:1,sy:1,r:0,set:1},mouth2:{x:0,y:8.8,sx:1,sy:1,r:0,set:1},mouth3:{x:0,y:8.8,sx:1,sy:1,r:0,set:2},mouth4:{x:0,y:8.8,sx:1,sy:1,r:0,set:2},mouth5:{x:0,y:8.8,sx:1,sy:1,r:0,set:2}},brows:{brows0:{x:0,y:0,sx:1,sy:1,r:0,set:1},brows1:{x:0,y:-4.5,sx:1,sy:1,r:0,set:1}}},this.colorsUl=makeElement(null,"ul","colors","colors"),this.colors={head:[0,"#ffcc99","#ffbe9a","#daa07a","#a66859","#836a56","#422F23","#fcdabf","#e2a589","#f0bc97","#c3886a","#d3965f","#FDE5A8","#FEDA18","#afafaf","#72BC20","#5497F7","#9572ED","#F06CA5"],hair:[0,"#FF6600","#0e0e0e","#393f4f","#6C635E","#3F190B","#5B2621","#633E35","#835336","#832E13","#3192D4","#813C18","#C77100","#DA9D01","#E19F58","#FFCB91","#FF8A4A","#F5E9D0","#F7F7F7","#A08C85","#75635E","#A5AA98","#43CECE","#FFFF00","#FF7836","#FF5A00","#E04327","#FF2C2C","#D30000","#A01A1D","#00A5A8","#009999","#0066FF","#004A8E","#00CE62","#009B60","#008636","#FF9BD2","#FF91B8","#FF43A0","#FF00A2","#CECEFF","#AE3EA3","#991F74","#6B397E","#A16F1A"],eyes:[0,"#000000","#5B341C","#803C2E","#AA8452","#396BB5","#5C89B4","#75666A","#246436","#538A63","#909090","#655074","#586669","#4F4D5C","#465D6F","#327891","#71A8DF","#B38D44","#A9AB86","#AAB9CD","#FF7836"],mouth:[0,"#990000","#E52B50","#5D8AA8","#014421","#3B444B","#98777B","#007FFF","#BF94E4","#CC5500","#E97451","#E34234","#008B8B","#ff0000"],items:[0,"#990000","#E52B50","#5D8AA8","#014421","#3B444B","#98777B","#007FFF","#BF94E4","#CC5500","#E97451","#E34234","#008B8B","#ff0000","#000000"],brows:[0,"#0e0e0e","#FF6600","#393f4f","#6C635E","#3F190B","#5B2621","#633E35","#835336","#832E13","#3192D4","#813C18","#C77100","#DA9D01","#E19F58","#FFCB91","#FF8A4A","#F5E9D0","#F7F7F7","#A08C85","#75635E","#A5AA98","#43CECE","#FFFF00","#FF7836","#FF5A00","#E04327","#FF2C2C","#D30000","#A01A1D","#00A5A8","#009999","#0066FF","#004A8E","#00CE62","#009B60","#008636","#FF9BD2","#FF91B8","#FF43A0","#FF00A2","#CECEFF","#AE3EA3","#991F74","#6B397E","#A16F1A"]},parent.addEventListener("message",this.onMessage.bind(this),!1),window.addEventListener("beforeunload",(()=>{this.Send(0,0,0)}));let s=0;this.Tick=setInterval((()=>{!this.connected&&s%12==0&&s<450&&this.Send(1,0,""),s++}),83),this.posX=document.querySelector("#posX"),this.posY=document.querySelector("#posY"),this.scaX=document.querySelector("#scaX"),this.scaY=document.querySelector("#scaY"),this.rot=document.querySelector("#rot"),this.save=document.querySelector("#save"),this.addFavorite=document.querySelector("#addFavorite"),this.posX.addEventListener("input",(s=>{this.hasPower(this.xavi)&&this.xaviCode[this.currentTab].x!=this.posX.value&&(this.xaviCode[this.currentTab].x=this.posX.value,this.xaviFrame.contentWindow.postMessage(JSON.stringify({user:this.userId,channel:this.xavi,msg:this.Encode({item:this.currentTab,x:this.posX.value,id:this.xaviCode[this.currentTab].id})}),this.xConfig.origin))})),this.posY.addEventListener("input",(s=>{this.hasPower(this.xavi)&&this.xaviCode[this.currentTab].y!=this.posY.value&&(this.xaviCode[this.currentTab].y=this.posY.value,this.xaviFrame.contentWindow.postMessage(JSON.stringify({user:this.userId,channel:this.xavi,msg:this.Encode({item:this.currentTab,y:this.posY.value,id:this.xaviCode[this.currentTab].id})}),this.xConfig.origin))})),this.scaX.addEventListener("input",(s=>{this.hasPower(this.xavi)&&this.xaviCode[this.currentTab].sx!=this.scaX.value&&(this.xaviCode[this.currentTab].sx=this.scaX.value,this.xaviFrame.contentWindow.postMessage(JSON.stringify({user:this.userId,channel:this.xavi,msg:this.Encode({item:this.currentTab,sx:this.scaX.value,id:this.xaviCode[this.currentTab].id})}),this.xConfig.origin))})),this.scaY.addEventListener("input",(s=>{this.hasPower(this.xavi)&&this.xaviCode[this.currentTab].sy!=this.scaY.value&&(this.xaviCode[this.currentTab].sy=this.scaY.value,this.xaviFrame.contentWindow.postMessage(JSON.stringify({user:this.userId,channel:this.xavi,msg:this.Encode({item:this.currentTab,sy:this.scaY.value,id:this.xaviCode[this.currentTab].id})}),this.xConfig.origin))})),this.rot.addEventListener("input",(s=>{this.hasPower(this.xavi)&&this.xaviCode[this.currentTab].r!=this.rot.value&&(this.xaviCode[this.currentTab].r=this.rot.value,this.xaviFrame.contentWindow.postMessage(JSON.stringify({user:this.userId,channel:this.xavi,msg:this.Encode({item:this.currentTab,r:this.rot.value,id:this.xaviCode[this.currentTab].id})}),this.xConfig.origin))})),document.querySelectorAll(".item").forEach((s=>{s.addEventListener("click",(()=>{s.dataset.tab!=this.currentTab&&this.switchTab(s.dataset.tab)}))})),this.addFavorite.addEventListener("click",(s=>{this.hasPower(this.xavi)?(this.favorites.push(this.xaviCode),localStorage.setItem("xavis",this.Encode(this.favorites)),this.faveSnackbar.show(2e3)):this.xaviSnackbar.show(2e3,"Xavi")})),this.save.addEventListener("click",(s=>{if(!this.hasPower(this.xavi))return void this.xaviSnackbar.show(2e3,"Xavi");let e=new FormData;if(e.append("u",this.userId),e.append("xavi",JSON.stringify(this.xaviCode)),console.log(this.WY,this.userId,JSON.stringify(this.xaviCode)),this.WY)for(let s in this.WY)this.WY.hasOwnProperty(s)&&e.append(s,this.WY[s]);let t=this.saveSnackbar,i=this.failSnackbar;fetch("https://rxat.ro/json/xavi2/put.php",{method:"POST",body:e}).then((function(s){console.log(s),200==s.status&&"OK"==s.statusText?t.show(2e3):i.show(2e3)})).catch((function(s){i.show(2e3)}))})),this.saveSnackbar=new Snackbar(["mob2.xavisaved","Xavi saved Successfully!"]),this.faveSnackbar=new Snackbar(["mob2.xavifavadded","Xavi added to favorites tab!"]),this.failSnackbar=new Snackbar(["mob2.wentwrong","Something went wrong. Try again!"]),this.powerSnackbar=new Snackbar(["mob2.xaviitempower","You need $1 power to use this item."]),this.xaviSnackbar=new Snackbar(["mob2.needpower","You need $1 power to use this feature."]),this.enoughSnackbar=new Snackbar(["mob2.xaviamount","You need [$1] Xavi powers to use this item."]),this.xVersion=localStorage.getItem("xVersion")?this.Decode(localStorage.getItem("xVersion")):this.xConfig.version,this.xItems=localStorage.getItem("xItems")?this.Decode(localStorage.getItem("xItems")):null,this.xTime=localStorage.getItem("xTime")?this.Decode(localStorage.getItem("xTime")):null,this.cb=JSON.parse(localStorage.getItem("todo")).w_cb}loadXavi(){this.loaded||(document.querySelector("#xaviFrame").innerHTML='<div class="refresh" id="refresh"></div>',this.xaviFrame=makeElement(document.querySelector("#xaviFrame"),"iframe","xaviFrame"),this.xaviFrame.scrolling="no",this.xaviFrame.src="../../xavi/xavi.html#editor&"+this.userId+"&"+this.Encode(this.powers),document.querySelector("#xaviFrame").style.position="relative",this.refresh=document.querySelector("#refresh"),this.refresh.addEventListener("click",(s=>{this.posX.value=0,this.posY.value=0,this.scaX.value=0,this.scaY.value=0,this.rot.value=0,this.xaviCode={head:{id:1,y:0,sx:0,sy:0,r:0,color:this.colors.head[0]},mouth:{id:1,x:0,y:0,sx:0,sy:0,r:0,color:this.colors.mouth[0]},eyes:{id:1,x:0,y:0,sx:0,sy:0,r:0,color:this.colors.eyes[0]},brows:{id:1,x:0,y:0,sx:0,sy:0,r:0,color:0},hair:{id:1,x:0,y:0,sx:0,sy:0,r:0,color:this.colors.hair[0]},items:{id:0,x:0,y:0,sx:0,sy:0,r:0,color:0}},document.querySelector(".color")&&(document.querySelectorAll(".color").forEach((s=>{s.classList.remove("on")})),document.querySelector(".color").classList.add("on")),document.querySelectorAll(".xavi").forEach((s=>{s.classList.remove("on")})),document.querySelectorAll(".xavi")[1].classList.add("on"),this.xaviFrame.contentWindow.postMessage(JSON.stringify({user:this.userId,channel:this.xavi,msg:"refresh"}),this.xConfig.origin)})),this.loaded=!0)}loadItem(s,e,t){let i=makeElement(s,"iframe","itemFrame");return i.scrolling="no",i.src="../../xavi/xavi.html#item&"+e+"&"+t,s.style.position="relative",i}Send(s,e,t){this.Trace(["Send = ",s,e,t]);let i={from:this.xConfig.name,channel:s,user:e,msg:t,tobox:1};parent.postMessage(JSON.stringify(i),this.xConfig.origin)}Receive(s,e,t){if(this.Trace(["Receive = ",s,e,t]),1!=s||this.connected||(this.connected=!0,this.Send(6,0,0),this.Send(9,0,"pssa"),this.Send(9,0,"sv"),this.Send(9,0,"WY"),this.Send(this.xConfig.channel,0,""),this.Trace(this.xConfig.name+" connected!"),clearInterval(this.Tick)),6==s&&(this.userId=e,this.loadXaviData()),9==s)if("pssa"==e){this.pssh={},this.pssa=t.split(",");for(let s=0;s<this.pssa.length;s++)this.pssh[this.pssa[s]]=s>1?s-1:s-2;this.MAXPOWER=this.pssa.length-1,this.w_Powers=[];let s=JSON.parse(localStorage.getItem("w_Powers"));for(let e in s)this.w_Powers[xInt(e)]=xInt(s[e]);this.w_PowerO=JSON.parse(localStorage.getItem("todo")).w_PowerO,this.setUserBank(),this.loadXavi()}else"WY"==e&&(this.WY=JSON.parse(t))}setUserBank(){if(null===this.w_Powers)return;null===this.powers&&(this.powers=[]);for(let s=1;s<this.MAXPOWER;s++){if(81==s||s%32==31)continue;let e=s%32,t=xInt(s/32);this.w_Powers[t]&1<<e&&(this.powers[s]=1)}let s=this.PowDecode(this.w_PowerO);if(null!==s){for(let e=1;e<this.MAXPOWER;e++)81!=e&&e%32!=31&&s[e]&&(this.powers[e]=xInt(this.powers[e])+s[e]);this.Trace(this.powers)}}PowDecode(s){if(null==s||0==s.length)return null;let e=[],t=(s=s.toString()).split("|");for(let s=0;s<t.length;s++){let i=t[s].split("="),r=xInt(i[1]);r<=0&&(r=1),r>1e4&&(r=1),e[i[0]]=r}return e}hasPower(s){if(!this.powers||0==this.powers.length)return 0;for(let e in this.powers)if(this.powers.hasOwnProperty(e)&&s==e)return this.powers[e];return 0}switchTab(s){if(this.currentTab!=s){switch(this.currentTab=s,this.posX.min=-10,this.posX.max=10,document.querySelectorAll(".item").forEach((e=>{e.dataset.tab==s?e.classList.add("on"):e.classList.remove("on")})),document.querySelectorAll(".setting").forEach((s=>{s.classList.remove("off")})),s){case"head":this.posX.value=0,this.posX.parentNode.classList.add("off");break;case"eyes":case"brows":this.posX.min=-4,this.posX.max=4;break;case"favorites":document.querySelectorAll(".setting").forEach((s=>{let e=s.getElementsByTagName("input")[0];"save"!=e.id&&s.classList.add("off"),"button"!=e.type&&(e.value=0)})),localStorage.getItem("xavis")&&(this.favorites=this.Decode(localStorage.getItem("xavis")))}"favorites"!=s&&("head"!=s&&(this.posX.value=Number(this.xaviCode[s].x)),this.posY.value=Number(this.xaviCode[s].y),this.scaX.value=Number(this.xaviCode[s].sx),this.scaY.value=Number(this.xaviCode[s].sy),this.rot.value=Number(this.xaviCode[s].r)),"favorites"==s?this.loadFavorites():this.loadItems()}}loadItems(){let s=document.querySelector("#xavis");s.innerHTML="";let e=Object.keys(this.elements[this.currentTab]);this.DebugMode||e.sort(((s,e)=>{let t=0;return this.elements[this.currentTab][s].set>this.elements[this.currentTab][e].set?t+=.5:this.elements[this.currentTab][s].set<this.elements[this.currentTab][e].set&&(t+=-.5),t})),e.forEach(((e,t)=>{let i=makeElement(s,"li","xavi",e);if(i.dataset.item=e.replace(this.currentTab,""),e==""+this.currentTab+this.xaviCode[this.currentTab].id&&i.classList.add("on"),!this.DebugMode&&(1!=this.elements[this.currentTab][e].set&&this.elements[this.currentTab][e].set>this.hasPower(this.xavi)||this.elements[this.currentTab][e].power&&!this.hasPower(this.elements[this.currentTab][e].power))&&i.classList.add("off"),xInt(i.dataset.item)>0){if(!this.DebugMode&&this.xItems&&this.xItems[e]&&this.xTime&&(Date.now()-this.xTime)/864e5<3&&xInt(this.xVersion)==this.xConfig.version){let s=new Image;s.draggable=!1,s.src=this.xItems[e],i.appendChild(s)}else i.appendChild(this.loadItem(i,this.currentTab,e.split(this.currentTab)[1]));addToolTip(i,"Click to use",!1,"low")}else i.style.backgroundImage="url(images/null.svg)",i.style.backgroundSize="70px",i.style.backgroundPosition="center",i.style.backgroundRepeat="no-repeat",addToolTip(i,"Click to remove",!1,"low");i.addEventListener("click",(()=>{if(!this.DebugMode){if(this.elements[this.currentTab][e].set>this.hasPower(this.xavi))return void(1==this.elements[this.currentTab][e].set?this.xaviSnackbar.show(2e3,"Xavi"):this.enoughSnackbar.show(2e3,this.elements[this.currentTab][e].set));if(this.elements[this.currentTab][e].power&&!this.hasPower(this.elements[this.currentTab][e].power))return void this.powerSnackbar.show(2e3,this.capitalize(this.pssa[xInt(this.elements[this.currentTab][e].power)+1]))}document.querySelectorAll(".xavi").forEach((s=>{s.classList.remove("on")})),i.classList.add("on"),this.xaviCode[this.currentTab].id=xInt(i.dataset.item),this.xaviFrame.contentWindow.postMessage(JSON.stringify({user:this.userId,channel:this.xavi,msg:this.Encode({item:this.currentTab,x:this.posX.value,y:this.posY.value,sx:this.scaX.value,sy:this.scaY.value,r:this.rot.value,color:this.xaviCode[this.currentTab].color,id:i.dataset.item})}),this.xConfig.origin)}))})),localStorage.setItem("xTime",this.Encode(Date.now())),localStorage.setItem("xVersion",this.Encode(this.xConfig.version)),this.colorsUl.innerHTML="",this.colors[this.currentTab]?(document.querySelector(".box").prepend(this.colorsUl),this.colors[this.currentTab].forEach((s=>{let e=makeElement(this.colorsUl,"li","color");e.dataset.color=s,e.style.background=s,this.xaviCode[this.currentTab].color==s&&e.classList.add("on"),e.addEventListener("click",(()=>{this.hasPower(this.xavi)?(document.querySelectorAll(".color").forEach((s=>{s.classList.remove("on")})),e.classList.add("on"),this.xaviCode[this.currentTab].color!=s&&(this.xaviCode[this.currentTab].color=s,this.xaviFrame.contentWindow.postMessage(JSON.stringify({user:this.userId,channel:this.xavi,msg:this.Encode({item:this.currentTab,color:s,id:this.xaviCode[this.currentTab].id})}),this.xConfig.origin))):this.xaviSnackbar.show(2e3,"Xavi")}))}))):this.colorsUl.parentNode&&this.colorsUl.parentNode.removeChild(this.colorsUl)}loadFavorite(s,e){let t=makeElement(s,"iframe","xaviFrame");return t.scrolling="no",t.frameBorder="none",t.src="../../xavi/xavi.html#fave&"+this.Encode(e),t.style.position="relative",t}loadFavorites(){let s=document.querySelector("#xavis");s.innerHTML="",this.favorites.forEach(((e,t)=>{let i=makeElement(s,"li","xavi fave"),r=makeElement(i,"div","del");addToolTip(i,"Click to use",!1,"low"),addToolTip(r,"Click to remove",!1,"low"),r.addEventListener("click",(s=>{let e=document.querySelector("#tooltips");e&&e.parentNode.removeChild(e),this.favorites.splice(t,1),i.parentNode.removeChild(i),localStorage.setItem("xavis",this.Encode(this.favorites)),s.stopPropagation()})),i.addEventListener("click",(s=>{if(!this.hasPower(this.xavi))return void this.xaviSnackbar.show(2e3,"Xavi");let t=document.querySelector("#tooltips");t&&t.parentNode.removeChild(t),this.xaviCode=JSON.parse(JSON.stringify(e)),this.xaviFrame.contentWindow.postMessage(JSON.stringify({user:this.userId,channel:this.xavi,msg:this.Encode(e)}),this.xConfig.origin),s.stopPropagation()})),this.loadFavorite(i,e)})),this.colorsUl.parentNode&&this.colorsUl.parentNode.removeChild(this.colorsUl)}loadXaviData(){let s={head:{id:1,y:0,sx:0,sy:0,r:0,color:0},mouth:{id:1,x:0,y:0,sx:0,sy:0,r:0,color:0},eyes:{id:1,x:0,y:0,sx:0,sy:0,r:0,color:0},brows:{id:1,x:0,y:0,sx:0,sy:0,r:0,color:0},hair:{id:1,x:0,y:0,sx:0,sy:0,r:0,color:0},items:{id:1,x:0,y:0,sx:0,sy:0,r:0,color:0}};fetch("https://rxat.ro/json/xavi2/get.php?u="+this.userId+"&cb="+parseInt(1e9*Math.random(),11)).then((e=>{if(200==e.status)return e.text();this.loadXaviData(s)})).then((e=>{this.xaviCode="No user."!=e?JSON.parse(e):s,this.switchTab("head")})).catch((e=>{this.xaviCode=s,this.switchTab("head")}))}onMessage(s){if(s.origin!==this.xConfig.origin)return void this.Trace(["onMessage Bad Origin = ",s.origin,s]);let e=JSON.parse(s.data);this.Receive(e.channel,e.user,e.msg)}capitalize(s){return s.charAt(0).toUpperCase()+s.slice(1)}Encode(s){return btoa(JSON.stringify(s))}Decode(s){return JSON.parse(atob(s))}Trace(s){if(!this.DebugMode)return;let e=s;Array.isArray(e)&&(e=e.join(" ")),console.log(e)}}