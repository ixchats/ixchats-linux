"use strict";let page,tab,tempFeature=[];document.body.style.backgroundColor="white",document.body.classList.remove("invisible"),$("#navGroup,#navxatApps").addClass("d-none"),Reset(),initConfig(),readUser(),setUser(),initLanguage(),initAuser3(),navClickHandlers(),startAnalytics(),setLoggedin(),legacyLinks(),cookieBar(),localize(["chats","buy"]),fetchPromo(),setLogo(),document.addEventListener("DOMContentLoaded",(function(){initStuff(),initToolTip()}));let pickersList=[],slimList=[],Commom=$("#CommonDiv").html();function DoTask(e){switch(e){case"lostpass":DoEditGroup(),$("#lostpwmodal").modal();break;case"creategroup":DoCreateGroup(e);break;case"editgroup":DoEditGroup(e);break;case"events":DoEvents(e);break;case"library":DoLibrary(e);break;default:e="creategroup",DoCreateGroup()}page=e,$(".NavTabs").removeClass("active"),$("#tab"+e).addClass("active")}function DoCreateGroup(){Reset();let e=$("#creategrouperr");$("#creategroup").removeClass("d-none"),$("#YourName").focus();let t=getGET(),a=!1,o=t.params.activate||"activate"===getRealHash(),n=t.params.id,s=t.params.gn;if(o&&n&&s)return doActivateGroup(n,s);let r=t.params.Token,l=t.params.GroupName;if(l&&r)return doConfirmDelete(l,r);$("#createyes").off("submit").submit((function(t){t.preventDefault();let o={},n=$("#YourName").val(),s=$("#GroupName").val(),r=$("#GroupDescription").val(),l=$("#Tags").val(),i=$("#password").val(),c=$("#email").val(),d=$("#Agree").is(":checked");$(".noread").attr("readonly",!0),$("html, body").animate({scrollTop:$(document).height()},"slow"),e.addClass("d-none"),o.YourName=filter(n),o.GroupName=filter(s),o.GroupDescription=filter(r),o.Tags=filter(l),o.password=filter(i),o.email=filter(c),o.submit=filter(1),o.agree=filter(d?"agree":""),a&&(o["g-recaptcha-response"]=grecaptcha.getResponse()),$(document.body).css({cursor:"wait"}),urlPost("https://rxat.ro/web_gear/chat/creategroup2.php",filter(o)).then((function(t){if($(document.body).css({cursor:"default"}),allErrsOff(),t.Err.captchasuccess){return"<p>",'<span data-localize="chats.groupmail">A confirmation email has been sent.</span> ','<span data-localize="chats.groupclick">You now need to click on the link in that email to activate your group.</span>',"</p>",'<p data-localize="chats.groupspam" class="font-weight-bold">Note: If you do not receive an email, check your spam inbox.</p>','<p class="font-weight-bold">(<span data-localize="chats.groupdelay">The email could take up to 30 minutes to arrive.</span>)</p>','<p class="mb-0">','<span data-localize="chats.groupcant">If you still cannot find your email, you may need to reapply using an email provider that works.</span> ','<span data-localize="chats.groupgm">Try a</span>',' <a class="nodeco" target="_blank" href="https://gmail.com">Gmail</a> ','<span data-localize="chats.groupacc">account</span>. ','<span data-localize="chats.groupoper">If your email provider does not deliver our emails, you will not be able to operate your chat.</span>',"</p>",void doSuccessMsg($("#creategrouphtml"),'<p data-localize="chats.groupthanks">Thank you. Your group application has been processed.</p><p><span data-localize="chats.groupmail">A confirmation email has been sent.</span> <span data-localize="chats.groupclick">You now need to click on the link in that email to activate your group.</span></p><p data-localize="chats.groupspam" class="font-weight-bold">Note: If you do not receive an email, check your spam inbox.</p><p class="font-weight-bold">(<span data-localize="chats.groupdelay">The email could take up to 30 minutes to arrive.</span>)</p><p class="mb-0"><span data-localize="chats.groupcant">If you still cannot find your email, you may need to reapply using an email provider that works.</span> <span data-localize="chats.groupgm">Try a</span> <a class="nodeco" target="_blank" href="https://gmail.com">Gmail</a> <span data-localize="chats.groupacc">account</span>. <span data-localize="chats.groupoper">If your email provider does not deliver our emails, you will not be able to operate your chat.</span></p>',!1)}if(t.Err.grpnameerr&&(e.addClass("d-none"),doErrorMsg(e,'<span data-localize="chats.notallowed">Group name contains invalid characters.</span>')),t.Err.captcha)return a=!0,AddCap("createcap"),void $("#createcap").addClass("capspace");a=!1,$("#createcap").removeClass("capspace"),DoErrs(t,"creategroup"),localize(["chats"])}))}))}$("#CommonDiv").html(""),GET.hash&&0==GET.params.length&&(location.hash="#"+GET.hash),$("#tabcreategroup,#tabeditgroup,#tabevents,#tablibrary").click((function(e){let t=e.currentTarget.id.substr(3);return DoTask(t),location.hash="#!"+doRealHash(location.hash,t),!1})),DoTask(getRealHash());let url="https://rxat.ro/web_gear/chat/editgroup3.php";function DoEditGroup(){Reset(),$("#editgroup").removeClass("d-none"),$("#Edpassword").focus(),$(".groupnamecol #GroupName").html("");let e=getGET(),t=$("#GroupNameI"),a=e.params.GroupName;a=-1===window.location.search.indexOf("GroupName=")&&-1===window.location.href.indexOf("GroupName=")?"":a,a?(t.addClass("d-none"),$(".groupnamecol #GroupName").html(filter(a))):t.removeClass("d-none"),$(".grouploginform").off("submit").submit((function(e){e.preventDefault();let o=a||t.val(),n=$("#Edpassword").val(),s=getTodo();s&&(s=JSON.parse(s));let r={},l=$("#editgrouperr");if(!o.length)return doErrorMsg(l,'<span data-localize="chats.grpempty">Group name cannot be empty</span>'),!1;l.addClass("d-none"),r.name=filter(o),r.password=filter(n),r.MainOwner=getUserId(),r.DeviceId=s&&s.DeviceId||"",r.PassHash=s&&s.PassHash||"",r.SubmitPass=1,$(document.body).css({cursor:"wait"}),urlPost(url,filter(r)).then((function(e){$(document.body).css({cursor:"default"}),e.Err.name?(e.GroupName=e.Err.name,e.password=n,e.TokenKey=e.Err.TokenKey,xConfig.obj=e,xConfig.obj.Err.mainsList=void 0,xConfig.obj.arrPow=filterPowers(e.Err.Powers),1!==e.Err.FullMain&&updateTabs(),enablePreview(),$("#editgroup").addClass("d-none"),$("#editgroup_edit").removeClass("d-none"),$("#mainNav").addClass("d-none"),$("#tabappearance,#tabtabs,#tabsettings,#tabgrouppowers,#tabmainowners,#tabmiscellaneous,#tabreturn,#tabembed").off("click").click((function(e){let t=e.currentTarget.id.substr(3);return"return"==t?(t="editgroup",DoReturn(),DoTask(t),!1):"embed"==t?doEmbed():(DoTask2(t),location.hash="#!"+doRealHash(location.hash,t),!1)})),DoTask2(getRealHash())):doErrorMsg(l,e.Err.editgroup)}))})),$(document).on("click","#lostpw",(function(e){doForgotPassword()}))}initSlimSeletect(["eventstype","eventspower","statstype"]);var urlE="https://rxat.ro/web_gear/chat/events2.php";function getByGroupName(e,t){e&&fetch("https://rxat.ro/api/roomid.php?d="+filter(e)).then((function(e){return e.json()})).then((function(e){t(e)})).catch((function(e){t(!1)}))}function DoEvents(e){Reset(),$("#events").removeClass("d-none");let t=getGET(),a=$("#eventserr"),o=($("#Stats"),$("#Search"),$("#olderres")),n=$("#eventstats"),s=$("#eventsresult"),r=$("#EventsGrp"),l=t.params.roomid||e,i=t.params.GroupName;if(l=-1===window.location.search.indexOf("roomid=")&&-1===window.location.href.indexOf("roomid=")?"":l,i&&!l){getByGroupName(i,(e=>{if(e)return location.hash="#!events&GroupName="+e.g+"&roomid="+e.id,DoEvents()}))}else l&&$("#events #GroupName").html(filter(i));let c=null;r&&r.off("keyup").on("keyup",(function(e){let t=$(this).val();clearTimeout(c),c=setTimeout((function(){if(t){getByGroupName(t,(e=>{if(e)return location.hash="#!events&GroupName="+e.g+"&roomid="+e.id,$("#events #GroupName").removeClass("d-none"),$("#eventsNoGrp").addClass("d-none"),DoEvents();location.hash="#!events",i=l=void 0,$("#events #GroupName").addClass("d-none"),$("#eventsNoGrp").removeClass("d-none")}))}}),500)})),xConfig.events||($(document.body).css({cursor:"wait"}),urlPost("https://rxat.ro/web_gear/chat/events2.php?j=1",{}).then((function(e){$(document.body).css({cursor:"default"}),xConfig.events=e,loadEventsModes()}))),google.charts.load("current",{packages:["corechart","table"]}),xConfig.get=t,$("#eventsyes").off("submit").submit((function(e){e.preventDefault();let t=getEventsParams();t.roomid=l,t.GroupName=i;let o=$("#eventspower").val(),s=$("#eventsuserid").val(),r=$("#eventstype").val();a.addClass("d-none"),t.search=filter(s)||"",t.Type=filter(r)||"",t.Power=filter(o)||"",t.Search=1,n.addClass("invisible"),n.addClass("statsvi"),$(document.body).css({cursor:"wait"}),urlPost(urlE,filter(t)).then((function(e){return $(document.body).css({cursor:"default"}),loadEventsResults(e.Err)}))})),o.off("click").on("click",(function(e){e.preventDefault();let t=$("#eventspower").val(),a=$("#eventsuserid").val(),o=$("#eventstype").val(),n=xConfig.eventsRes;if(n){let e=getEventsParams();e.roomid=l,e.GroupName=i,e.from=n.count,e.from1=n.nextfrom,e.search=filter(a)||"",e.Type=filter(o)||"",e.Power=filter(t)||"",e.Search=1,$(document.body).css({cursor:"wait"}),urlPost(urlE,filter(e)).then((function(e){return $(document.body).css({cursor:"default"}),loadEventsResults(e.Err)}))}})),$("#statsyes").off("submit").submit((function(e){e.preventDefault();let t=getEventsParams();t.roomid=l,t.GroupName=i;let o=$("#statsuserid").val(),n=$("#staysdays").val(),r=$("#statstype").val();a.addClass("d-none"),t.userid=filter(o)||"",t.Type=filter(r)||"",t.days=filter(n&&n<=14?n:7),t.Stats=1,s.addClass("d-none"),$(document.body).css({cursor:"wait"}),urlPost(urlE,filter(t)).then((function(e){return $(document.body).css({cursor:"default"}),loadEventsStats(e.Err)}))})),localize(["buy"])}function loadEventsModes(){if(!xConfig.events)return!1;let e=xConfig.events,t=$("#eventstype"),a=$("#statstype"),o=$("#eventspower"),n=e.Modes,s=e.Powers,r='<option value="" data-localize="chats.all">All</option>';for(let e in n)r+='<option value="'+e+'">'+n[e]+"</option>";t.html(r),a.html(r);let l='<option value="" data-localize="chats.all">All</option>';for(let e in s)l+='<option value="'+e+'">'+s[e]+"</option>";o.html(l),localize(["chats"])}function loadEventsStats(e){let t=$("#eventstats"),a=$("#eventserr"),o=$("#errnoresult");e.stats?(google.charts.setOnLoadCallback(drawChart(e.stats)),t.removeClass("invisible"),t.removeClass("statsvi"),a.addClass("d-none")):(e.events&&"string"==typeof e.events||e.notfound)&&(t.addClass("invisible"),a.removeClass("d-none"),t.addClass("statsvi"),doErrorMsg(a,e.events||e.notfound.replace(/<[^>]*>?/gm,""))),o.addClass("d-none"),document.getElementById("eventstats").scrollIntoView({behavior:"smooth",block:"start"})}function drawChart(e){var t=google.visualization.arrayToDataTable(e.datakp),a=google.visualization.arrayToDataTable(e.datakb),o=google.visualization.arrayToDataTable(e.Who),n=google.visualization.arrayToDataTable(e.Table),s={width:700,is3D:!0,backgroundColor:{fill:"transparent"},chartArea:{width:"95%",height:"95%"}},r={width:800,height:600,legend:{position:"right",maxLines:3},backgroundColor:{fill:"transparent"},bar:{groupWidth:"75%"},chartArea:{width:"45%",height:"80%"},isStacked:!0};new google.visualization.PieChart(document.getElementById("piechart_3d_k")).draw(t,s),new google.visualization.ColumnChart(document.getElementById("barchart_k")).draw(a,r),new google.visualization.ColumnChart(document.getElementById("barchart_who")).draw(o,r),new google.visualization.Table(document.getElementById("datatable")).draw(n,s)}function loadEventsResults(e){let t=$("#eventsresult"),a=$("#eventserr"),o=$("#eventsList"),n=$("#evresultcon"),s=$("#errnoresult"),r="",l=!1;if(e.events)if(n.removeClass("d-none"),s.addClass("d-none"),"string"==typeof e.events)s.addClass("d-none"),t.addClass("d-none"),doErrorMsg(a,e.events);else{for(let t in e.events){let a=e.events[t][1],o=e.events[t][3],n=getClassIfNeeded(o);o=o.replace("demote to member","demote to mem"),null!==a?(a=a.replace(/<[^>]*>?/gm,""),a='<a href="" id="unmodm" data-toggle="modal" data-id="'+a+'" data-target="#demotemodmodal" class="nodeco">'+a+"</a>"):a="",r+="<tr>",r+='<th scope="row">'+t+"</th>",r+="<td>"+e.events[t][0]+"</td>",r+="<td>"+a+"</td>",r+="<td>"+(null==e.events[t][2]?"":e.events[t][2])+"</td>",r+='<td><img src="'+getEventsImage(o)+'" class="'+n+' iconbr" width="22"> '+o+"</td>",r+="<td>"+(null==e.events[t][4]?"":e.events[t][4])+"</td>",r+="<td>"+(null==e.events[t][5]?"":e.events[t][5])+"</td>",r+="<td>"+(null==e.events[t][6]?"":e.events[t][6])+"</td>",r+="<td>"+(null==e.events[t][7]?"":filter(e.events[t][7],!0))+"</td>",r+="</tr>"}xConfig.eventsRes=e,l=!0,a.addClass("d-none"),t.removeClass("d-none")}else n.addClass("d-none"),s.removeClass("d-none");o.html(r),document.getElementById("eventsresult").scrollIntoView({behavior:"smooth",block:"start"}),l&&document.querySelectorAll("#unmodm").forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();let t=e.target.dataset.id,o=$("#demotemodmodal");if(!t)return!1;o.modal(),$("#unmod").off("click").on("click",(function(e){o.modal("hide"),e.preventDefault();let n=getEventsParams();a.addClass("d-none"),n.MainOwner=xConfig.id||0,n.id=xConfig.get.params.roomid||5,n.UnMod=t,$(document.body).css({cursor:"wait"}),urlPost(urlE,n).then((function(e){if($(document.body).css({cursor:"default"}),e.Err.UnMod){let t=e.Err.UnMod;t.indexOf("done")>=0?(doSuccessMsg(a,'<span data-localize="chats.demsuc">User has been demoted</span>'),$("body,html").animate({scrollTop:0},800)):t.indexOf("Not enough rank")>=0?(doErrorMsg(a,'<span data-localize="chats.demfail">Your rank is not high enough</span>'),$("body,html").animate({scrollTop:0},800)):(doErrorMsg(a,'<span data-localize="chats.demfailoth">User could not be demoted</span>'),$("body,html").animate({scrollTop:0},800))}}))}))}))}))}function getEventsParams(){let e={},t=getTodo();return t&&(t=JSON.parse(t)),e.DeviceId=t&&t.DeviceId||"",e.PassHash=t&&t.PassHash||"",e.Id=t&&t.w_userno||0,e}function getClassIfNeeded(e){let t="";if(e.indexOf("un-")>=0||e.indexOf("UnBan")>=0)t="unevicon";else switch(e.replace(/ /gi,"")){case"protectoff":t="protevicon";break;case"demotetoguest":case"demotetomember":t="demguestic";break;case"demotetomod":t="demguestic demmodin";break;case"kick":t="kickic";break;case"yellowcard":case"badge":case"kickall":case"redcard":t="yellowic";break;case"un-yellowcard":case"un-redcard":case"un-badge":t="unevicon yellowic";case"restore":t="restoreic";break;case"promotion":t="promoic"}return t}function getEventsImage(e){e=(e=(e=(e=(e=(e=e.replace(/ /gi,"")).replace("un-","")).replace(/naughty/gi,"naughtystep")).replace(/muted/gi,"mute")).replace(/tempmember/gi,"tempmem")).toLowerCase(),["mazeunban","spaceunban","codeunban","matchunban","snakeunban","slotunban"].indexOf(e)>=0&&(e=e.replace(/unban/gi,"ban")),"redcardself"==e&&(e="redcard");let t={ban:"actBan",protecton:"actCancel",protectoff:"actCancel",kick:"actKick",makeguest:"actMakeGuest",makemember:"actMakeMember",makemod:"actMakeModerator",makeowner:"actMakeOwner",unban:"actUnban",demotetoguest:"demoteguest",demotetomem:"demotemember",demotetomod:"demotemod",restore:"download",promotion:"promotion",setscroller:"setscroll"},a=["badge","dunce","gag","guestself","hush","kickall","mute","naughtystep","ranklock","redcard","sinbin","tempmem","yellowcard","snakeban","spaceban","matchban","codeban","mazeban","zip","reverse","slotban"];return t[e]?"https://rxat.ro/content/img/events/"+t[e]+".svg":a.indexOf(e)>=0?"https://rxat.ro/images/smw/"+a[a.indexOf(e)]+".png":""}function DoLibrary(){Reset(),$("#library").removeClass("d-none"),doLibraryList()}let other=!1;function doLibraryList(){$.ajax("https://util.rxat.ro/wiki/api.php?action=parse&page=Area51:Xatframe-entries&prop=wikitext&formatversion=2&format=json&origin=*",{success:function(e){var t=shuffle($.csv.toArrays(e.parse.wikitext));showEntrants($.csv.toArrays(e.parse.wikitext)),showList(t),$("#num").off("click").on("click",(function(){$("#onclickInfo").addClass("d-none"),showList(t=sortnew(t,other)),other?(other=!1,$("#num").html("9-1")):(other=!0,$("#num").html("1-9"))})),$("#all").off("click").on("click",(function(){$('[data-clickable="true"]').show(),$('[data-clickable="false"]').show(),$("#onclickInfo").addClass("d-none"),$(".libtop").removeClass("d-none")})),$("#clickable").off("click").on("click",(function(){$("#all").removeClass("d-none"),$('[data-clickable="false"]').hide(),$('[data-clickable="true"]').show(),$("#onclickInfo").removeClass("d-none"),$(".libtop").addClass("d-none")}))}})}function showList(e){if(e.length){for(var t of($("#out").html(""),e))$("#out").append("<div class='col-xs-12 col-sm-12 col-md-6 col-lg-4 col-xl-3' data-clickable='"+("clickable"==t[5]?"true":"false")+"'><div class='text-center xfcard'><p class='xfname'><span>"+t[3]+"</span></p><img class='mt-1' width='240' height='135' src='"+t[1]+"'><p class='xfbut nosel'><span><a class='btn btn-outline-primary btn-sm xfbutpa' target='_blank' href='"+t[2]+"' data-localize='chats.preview'>preview</a></span><span> <a id='libcopy' href='#' class='libcopy btn btn-outline-primary btn-sm ml-2 xfbutpa' data-url='"+t[2]+"' data-toggle-sec='tooltip' data-placement='top' data-html='true' title='<span data-localize=chats.copied>Copied</span>!'><span data-localize='chats.copy'>copy</span></a></span></p>"+("transparent"==t[4]?"<p class='xftransbut'><a class='transreq nosel' href='https://util.rxat.ro/wiki/Html5:Owners_Guide#Additional_options' target='_blank' data-localize='chats.transuit'>Suitable for transparent chat</a></p>":"")+"</div></div>");framecopy(),localize(["chats"])}}function showEntrants(e){$("#topFive").html("");let t={};for(var a of e){let e=a[3].replace(/[^a-z]/gi,"");e&&(t[e]||(t[e]=0),t[e]++)}let o=[];if(t){for(let e in t)t.hasOwnProperty(e)&&t[e]>1&&o.push([e,t[e]]);o=shuffle(o),o.sort(((e,t)=>t[1]-e[1])),o=o.slice(0,5);for(let e in o)$("#topFive").append("<span>"+o[e][0]+" ("+o[e][1]+") </span>")}}function framecopy(){let e=document.querySelectorAll("#libcopy");if($(".libcopy").tooltip({trigger:"click",placetop:"top"}),e.length>0)for(let t in e)"object"==typeof e[t]&&e[t].addEventListener("click",(e=>{e.preventDefault();let t=e.target.nodeName,a=e.target.dataset;if("A"!==t&&(a=e.target.parentNode.dataset),void 0!==a&&a.url){var o=document.createElement("textarea");o.value=a.url,o.style.top="0",o.style.left="0",o.style.position="fixed",document.body.appendChild(o),o.focus(),o.select(),document.execCommand("copy"),setTimeout((function(){$(".libcopy").tooltip("hide")}),1e3),localize(["chats"])}}))}function shuffle(e){let t=e.length;for(;t>0;){let a=Math.floor(Math.random()*t);t--;let o=e[t];e[t]=e[a],e[a]=o}return e}function sortnew(e,t){return e.sort(((e,a)=>t?e[0]-a[0]:a[0]-e[0])),e}function DoTask2(e){switch(e){case"appearance":DoAppearance();break;case"tabs":DoTabs();break;case"settings":DoSettings();break;case"grouppowers":DoGroupPowers();break;case"mainowners":DoMainOwners();break;case"miscellaneous":DoMisc();break;case"return":DoReturn();break;default:e="appearance",DoAppearance()}page=e,$("#editgroup_edit").removeClass("d-none"),$(".NavTabs").removeClass("active"),$("#tab"+e).addClass("active")}function DoAppearance(){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();Reset(),$("#appearance").removeClass("d-none"),handleAppearanceTab()}function DoMisc(){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();Reset(),$("#miscellaneous").removeClass("d-none");let e=xConfig.obj,t=e.Err,a=$("#BackupUsers"),o=$("#chatbackupselect"),n=$("#RestoreUsers"),s=$("#backupusers"),r=hasPower(310),l=$("#miscsuccess"),i=$("#GetMainOk"),c=$("#getmain");$(document).on("click","#changepw",(function(e){e.preventDefault(),doChangePassword()})),$(document).on("click","#resetchat",(function(e){e.preventDefault(),doResetChat()})),$(document).on("click","#deletegroup",(function(t){t.preventDefault(),doDeleteGroup(e)})),r?(s.attr("disabled",!1),s.removeClass("plusic"),s.removeClass("nohov")):(s.attr("disabled",!0),s.addClass("plusic"),s.addClass("nohov")),s.off("click").on("click",(function(e){if(e.preventDefault(),!r)return!1;$("#backupusersmodal").modal()})),a.off("click").on("click",(function(t){$("#backupusersmodal").modal("hide");let a=getPostParam();a.BackupUsers=1,$(document.body).css({cursor:"wait"}),urlPost(url,a).then((function(t){if($(document.body).css({cursor:"default"}),t.Err.xatu)return doSuccessMsg(l,'<span data-localize="chats.downlsuc">Backup file has been downloaded</span>'),doDownload(atob(t.Err.xatu),e.GroupName+".xatu");DoErrs(t,"backupusers")}))})),o.off("change").on("change",(function(e){let t=$(this);updateFileName(t),n.removeClass("d-none"),n.off("click").on("click",(function(a){if($("#backupusersmodal").modal("hide"),e.target.files){uploadFile(e.target.files[0],(function(e){let a=getPostParam();a.RestoreUsers=btoa(e),$(document.body).css({cursor:"wait"}),urlPost(url,a).then((function(e){$(document.body).css({cursor:"default"}),updateFileName(t,!0,n);$("#backupuserserr");e.Err.retoreusersok?doSuccessMsg(l,'<span data-localize="chats.urestored">'+e.Err.retoreusersok+"</span>"):doErrorMsg(l,e.Err.editgroup)}))})),t.val("")}}))})),i.off("click").on("click",(function(e){if(c.modal("hide"),null==xConfig.id)return doErrorMsg(l,'<span data-localize="chats.needlogin">Please <a href="//rxat.ro/login">log in</a> to use this page.</span>'),void $("body,html").animate({scrollTop:0},800);let a={};void 0!==t.mains&&(a=JSON.parse(t.mains));let o=getPostParam(),n=0;for(let e in permissions)n|=e;a[xConfig.id]=n,l.addClass("d-none"),o.SetMains=JSON.stringify(a),$(document.body).css({cursor:"wait"}),urlPost(url,o).then((function(e){$(document.body).css({cursor:"default"}),e.Err.mains&&(xConfig.obj.Err.mainsList=void 0,doSuccessMsg(l,'<span data-localize="chats.getmainok">Your main owner chat rank has been restored</span>'),$("body,html").animate({scrollTop:0},800)),e.Err.Save&&(doErrorMsg(l,e.Err.Save),$("body,html").animate({scrollTop:0},800))}))}))}function doChangePassword(){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();$("#pwmodal").modal(),$("#changeyes").off("submit").submit((function(e){e.preventDefault();let t=$("#changepasserr"),a=xConfig.obj,o=$("#oldpassword").val(),n=$("#newpassword").val(),s=$("#confirmpassword").val(),r={};t.addClass("d-none"),r.name=a.GroupName,r.password0=filter(o),r.password1=filter(n),r.password2=filter(s),r.MainOwner=filter(getUserId()),r.TokenKey=filter(a.TokenKey),r.NewPass=1,$(document.body).css({cursor:"wait"}),urlPost(url,filter(r)).then((function(e){$(document.body).css({cursor:"default"}),e.Err&&(e.Err.changepassok?(doSuccessMsg(t,'<div class="cplogout"><span>'+e.Err.changepassok+'</span>&nbsp;<span><span data-localize"chats.cplogout">You will be logged out now</span>..</span></div>'),setTimeout((()=>{window.location.reload(!0)}),4e3)):doErrorMsg(t,e.Err.changepass))}))}))}function doResetChat(){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();$("#resetmodal").modal(),$("#ResetChat").off("click").click((function(e){$("#resetmodal").modal("hide");xConfig.obj;let t=getPostParam();t.ResetChat=1,$(document.body).css({cursor:"wait"}),urlPost(url,t).then((function(e){$(document.body).css({cursor:"default"});$("#resetchaterr");let t=$("#miscsuccess");e.Err.ChatPass?(doSuccessMsg(t,'<span data-localize="chats.resetok">Your chat has been reset</span>'),xConfig.obj.TokenKey=refreshToken(e.Err.ChatPass),$("body,html").animate({scrollTop:0},800)):e.Err.editgroup?(doErrorMsg(t,'<span data-localize="buy.relogin">Security check failed (3). Click <a href=http://rxat.ro/login>here to re-login to xat chat</a></span>'),$("body,html").animate({scrollTop:0},800),localize(["buy"])):(doErrorMsg(t,e.Err.ChatPass),$("body,html").animate({scrollTop:0},800))}))})),localize(["buy"])}function doDeleteGroup(){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();$("#deletemodal").modal(),$("#delyes").off("submit").submit((function(e){e.preventDefault(),allErrsOff();let t=!1,a=xConfig.obj,o={},n=a.GroupName,s=$("#deletemodal #grpemail").val(),r=$("#deletemodal #grppassword").val(),l=$("#confirmdelete").is(":checked"),i=$("#deletegrouperr"),c=$("#miscsuccess");if(i.addClass("d-none"),!l){return doErrorMsg(i,{Err:{deletegroup:'<span data-localize="chats.notconf">You must confirm that you want to proceed</span>'}}.Err.deletegroup),!1}i.addClass("d-none"),o.name=n,o.email=filter(s),o.password=filter(r),o.MainOwner=getUserId(),o.TokenKey=a.TokenKey,o.DeleteGroup=1,$(document.body).css({cursor:"wait"}),urlPost(url,filter(o)).then((function(e){$(document.body).css({cursor:"default"}),e.Err&&(e.Err.deletegroupok?(t=!0,$("#deletemodal").modal("hide"),$("#deletemodal").off("hidden.bs.modal").on("hidden.bs.modal",(function(){t&&(doSuccessMsg(c,e.Err.deletegroupok),$(this).find("form").trigger("reset"),$("body,html").animate({scrollTop:0},800),t=!1)}))):doErrorMsg(i,e.Err.deletegroup))}))}))}function DoTabs(){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();Reset(),$("#tabs").removeClass("d-none");xConfig.obj;let e=getPostParam();e.GetMedia=1,$(document.body).css({cursor:"wait"}),urlPost(url,filter(e)).then((function(e){return $(document.body).css({cursor:"default"}),e.Err.Media?loadTab(e.Err.Media):$("#tabreturn").click()}))}function loadTab(e){if(-1==e.indexOf(";="))return!1;let t=xConfig.obj;e=e.split(";=");let a=$("#selecttab"),o=$("#remtab"),n=$("#removetab"),s=$("#ordertab"),r=($("#backuptab"),$("#newtab")),l={},i=0,c="button0",d=$("#tabname"),u=$("#summernote"),p=$("#TabsSubmit"),m=$("#BackupTab"),f=$("#tabbackupselect"),g=$("#RestoreTab"),h=$("#tabserr"),b=$("#backuptabmodal"),v=$(".tabmodaldownl"),k=$("#plusicon");for(let t in e){let a=parseInt(t)+1;t%2&&""!==e[t]&&(l["button"+i]={tabName:filter(e[t]),tabContent:e[a]},i++)}0==Object.keys(l).length?(setTab(l,"selecttab"),EnabledisableCleanFields(a,d,u,n,s,v,!0),k.addClass("blink")):(setTab(l,"selecttab"),setDefaultTab(l[c])),6==Object.keys(l).length&&k.addClass("plusic"),d.off("keyup").on("keyup",(function(){l[c].tabName=filter($(this).val(),""),setTab(l,"selecttab"),a.val(c)})),u.off("summernote.change").on("summernote.change",(function(e){let t=a.val();void 0!==l[t]&&(l[t].tabContent=$("#summernote").summernote("code"),setTab(l))})),r.off("click").on("click",(function(){let e=$("#selecttab option"),t=e.last();t=t.length?t.data().id:null;let o=null==t?0:t+1;e.length<6?(l["button"+o]={tabName:"New tab",tabContent:"\n"},EnabledisableCleanFields(a,d,u,n,s,v,!1),setTab(l,"selecttab"),setDefaultTab(l["button"+o]),a.val("button"+o),c=a.val(),doSuccessMsg(h,'<span data-localize="chats.tabadded">New tab has been added</span> <span class="alerttab">(<span data-localize="chats.saveneeded">changes only take effect after clicking the save button</span>)</span>'),6==Object.keys(l).length&&k.addClass("plusic")):(k.addClass("plusic"),doErrorMsg(h,'<span data-localize="chats.tabsnomore">You cannot add more than 6 tabs</span>'))})),m.off("click").on("click",(function(a){b.modal("hide");let o=[];o[0]=e[0];for(let e in l)l[e]&&null==l[e].deleted&&(o.push(l[e].tabName),o.push(l[e].tabContent));return doSuccessMsg(h,'<span data-localize="chats.downlsuc">Backup file has been downloaded</span>'),doDownload(o.join(";="),t.GroupName+"_Tabs.xatg")})),f.off("change").on("change",(function(e){let t=$(this);updateFileName(t),g.removeClass("d-none"),g.off("click").on("click",(function(){let o=e.target.files;o.length&&(o=o[0],uploadFile(o,(function(e){return updateFileName(t,!0),g.addClass("d-none"),b.modal("hide"),doSuccessMsg(h,'<span data-localize="chats.tabsimpsuc">Tabs have been imported</span> <span class="alerttab">(<span data-localize="chats.saveneeded">changes only take effect after clicking the save button</span>)</span>'),EnabledisableCleanFields(a,d,u,n,s,v,!1),loadTab(e)}))),f.val("")}))})),p.off("click").on("click",(function(e){e.preventDefault();let a=getPostParam(),o=$("#tabserr");for(let e in l)void 0!==l[e].deleted&&(l[e].tabName="",l[e].tabContent=""),l[e].tabContent.includes("&lt;embed src=")&&(l[e].tabContent=l[e].tabContent.replace(/&lt;embed src=/gi,"notanymore")),a[e]=filter(l[e].tabName),a[e.replace(/button/,"media")]=l[e].tabContent.replace(/script/gi,"");for(let e in t.Err)-1==["Powers","mains","mainsList"].indexOf(e)&&(a[e]=t.Err[e]);0==Object.keys(l).length&&(doErrorMsg(o,'<span data-localize="chats.tabscant">You cannot save without any tabs</span>'),$("body,html").animate({scrollTop:0},800)),h.addClass("d-none"),a.submit1=1,a.SetTabs=Object.keys(l).length,$(document.body).css({cursor:"wait"}),urlPost(url,a).then((function(e){$(document.body).css({cursor:"default"}),e.Err.Save&&(doErrorMsg(o,e.Err.Save),$("body,html").animate({scrollTop:0},800)),e.Err.SaveTabsOk&&(doSuccessMsg(o,'<span data-localize="chats.tabsaved">Your tabs have been updated</span>'),$("body,html").animate({scrollTop:0},800)),e.Err.editgroup&&doLogout(e.Err.editgroup)}))})),a.on("change",(function(e){c=this.value,setDefaultTab(l[c])})),o.off("click").on("click",(function(e){e.preventDefault(),$("#removetabmodal").modal("hide"),void 0!==l[c]?(l[c].deleted=!0,setTab(l,"selecttab"),c=a.val(),setDefaultTab(l[c]),k.removeClass("plusic"),doSuccessMsg(h,'<span data-localize="chats.tabsgone">Tab has been removed</span> <span class="alerttab">(<span data-localize="chats.saveneeded">changes only take effect after clicking the save button</span>)</span>'),0==$("#selecttab option").length&&(EnabledisableCleanFields(a,d,u,n,s,v,!0),k.addClass("blink"))):EnabledisableCleanFields(a,d,u,n,s,v,!0)})),s.off("click").on("click",(function(e){e.preventDefault(),setTab(l,"tabposition"),$("button[data-option]").off("click").on("click",(function(){var e=$("#tabposition option:selected"),t=$(this).data("option");if(e.length&&t.length){let o=e.first().prev(),n=o.val(),s=e.first().next(),r=s.val(),i=e.val(),c=l[n],d=l[i],u=l[r];"up"==t?void 0!==n&&(l[n]=d,l[i]=c,e.val(n),o.val(i),a.val(n),e.first().prev().before(e)):void 0!==r&&(l[r]=d,l[i]=u,e.val(r),s.val(i),a.val(r),e.last().next().after(e)),setTab(l,"selecttab"),setDefaultTab(l[a.val()])}}))}))}function EnabledisableCleanFields(e,t,a,o,n,s,r){if(!t||!a)return!1;let l=$("#plusicon");r?(t.val(""),t.prop("disabled",!0),e.prop("disabled",!0),a.summernote("code",""),a.next().find(".note-editable").attr("contenteditable",!1),o.css("display","none"),n.css("display","none"),s.css("display","none")):(t.removeAttr("disabled"),e.removeAttr("disabled"),a.next().find(".note-editable").attr("contenteditable",!0),o.css("display",""),n.css("display",""),s.css("display",""),l.removeClass("blink"))}function setTab(e,t){if(!e)return!1;let a="",o=$("#"+t);for(let t in e)void 0!==e[t]&&null==e[t].deleted&&(a+='<option value="'+t+'" data-id="'+t.replace(/button/,"")+'">'+e[t].tabName+"</option>");o.html(a)}function setDefaultTab(e){if(!e)return!1;let t=$("#tabname"),a=$(".note-editable");t.val(e.tabName),a.html(e.tabContent)}function DoSettings(){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();Reset(),$("#settings").removeClass("d-none"),handleSettingsTab()}function uploadFile(e,t){let a=new FileReader;a.onload=function(e){t(e.target.result)},a.readAsText(e)}function doDownload(e,t){let a=document.createElement("a");a.href="data:text/plain;charset=utf-8,"+e,a.setAttribute("download",t),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}function doActivateGroup(e,t){if(!e||!t)return!1;let a={};var o=getTodo();o&&(o=JSON.parse(o)),a.gn=t,a.id=e,a.MainOwner=getUserId(),a.DeviceId=o&&o.DeviceId||"",a.PassHash=o&&o.PassHash||"",a.activate=1;$("#creategrouphtml");var n="<p>";n+='<span data-localize="chats.groupthanks">Thank you. Your group has been activated.</span>',n+=" <span data.localize=chats.seemail>See email for details.</span>",n+="</p>",n+='<p class="mb-0">',n+='<span data-localize="chats.yourgroup">The address of your group is</span>:',n+=' <a class="nodeco" href=https://rxat.ro/'+t+">https://rxat.ro/"+t+"</a>",n+="</p>",$(document.body).css({cursor:"wait"}),urlPost("https://rxat.ro/web_gear/chat/activategroup2.php",filter(a)).then((function(e){$(document.body).css({cursor:"default"});let t=$("#creategrouphtml");e.Err.activategroupfail?doErrorMsg(t,e.Err.activategroupfail,!1):doSuccessMsg(t,n,!1)}))}function doConfirmDelete(e,t){if(!e||!t)return!1;let a=$("#creategrouphtml"),o={};o.name=e,o.delgrp=t,o.MainOwner=getUserId(),o.DeleteGroup=1,$(document.body).css({cursor:"wait"}),urlPost("https://rxat.ro/web_gear/chat/editgroup3.php",filter(o)).then((function(e){$(document.body).css({cursor:"default"}),e.Err.deletegroupok?doSuccessMsg(a,'<span data-localize="chats.deldone">Group information has been deleted</span>.',!1):doErrorMsg(a,'<span data-localize="chats.delalr">Group information has already been deleted</span>.',!1)}))}function DoGroupPowers(){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();Reset(),$("#grouppowers").removeClass("d-none");let e=$("#powfilter"),t=$("#nopowers"),a=$("#gpSearch"),o=$("#PowersSubmit"),n=xConfig.obj,s=getPostParam();s.GetPowers=1,s.Definitions=1;let r=new SlimSelect({select:"#powfilter",showSearch:!1,closeOnSelect:!0,placeholder:" "});t.addClass("d-none"),a.val(""),r.set("asg_una"),o.removeClass("d-none"),$(document.body).css({cursor:"wait"}),urlPost(url,s).then((function(s){if($(document.body).css({cursor:"default"}),s.Err.Powers){let r,l=$("#groups_powers"),i=s.Err.Powers.Powers,c=s.Err.Powers.GroupPowers,d=s.Err.Powers.Definitions,u=getUnassignedPowers(i,c),p=$("#gpexport"),m=($("#gpimport"),$("#importgpfile")),f=$("#gp_list_import"),g=$("#gp_list"),h=$("#importgpok"),b=$("#gpexperr"),v=$("#gpsuccess"),k=handlePowers(Object.assign({},i,u),c,d);l.html(k),localize(["chats"]),initPopover(),updateCheckBoxState(),updateProgress(getTotalAssigned(i),Object.keys(c).length),document.querySelectorAll("#gp_modalB").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();var t=e.target.parentNode.dataset.id;loadModal(t=null==t?e.srcElement.dataset.id:t,c[t].s)}))}));let y=document.querySelector("#gp_linkmodal");y&&y.addEventListener("click",openLinkModal),p.off("click").on("click",(function(e){if(e.preventDefault(),0==getTotalAssigned(i))return doErrorMsg(v,'<span data-localize="chats.gpexpassig">You must have at least one assigned power in order to export</span>'),!1;if(r=buildGpList(i,c,!0)){$("#exportmodal").modal();let e='<div class="row">';e+=r,e+="</div>",g.html(e);let t=$("#exportgpok"),a=$("#exportmodal");t.off("click").on("click",(function(e){e.preventDefault();let t=$('#gp_list input[type="checkbox"]:checked');if(0==t.length)return doErrorMsg(b,'<span data-localize="chats.gpexpsel">You must select at least one power in order to export</span>'),!1;let o={};for(let e in t){let a=t[e].id,n=document.getElementById("gi_"+a);null!==n&&n.value&&(o[a]=n.value)}doDownload(encodeURIComponent(JSON.stringify(o)),[n.GroupName,"powers"].join("_")+".xatp"),a.modal("hide"),doSuccessMsg(v,'<span data-localize="chats.gpexpsuc">Selected group powers have been exported</span>')}))}else doErrorMsg(v,'<span data-localize="chats.gpexpassedit">You must have edited at least one assigned group power in order to export</span>')})),$("#exportmodal, #importmodal").off("hide.bs.modal").on("hide.bs.modal",(function(e){let t=$("#xatpselect");f.html(""),g.html(""),h.addClass("d-none"),t.removeClass("xpspace")})),m.off("change").on("change",(function(e){let t=$(this);updateFileName(t);let a=e.target.files,o=$("#gpimperr");f.html(""),a&&uploadFile(a[0],(function(e){try{proceedImport(e=JSON.parse(e),c,t)}catch(e){doErrorMsg(o,'<span data-localize="chats.gpimpemp">Selected file is empty or invalid</span>')}})),$(this).val("")})),$("#PowersSubmit").off("click").click((function(e){if(e.preventDefault(),null==typeof i)return!1;for(let e in i){let t=i[e].split("|"),a=d[e],o=$("#gp_"+e).is(":checked"),n=$("#gi_"+e).val();t[1]=o?1:0,-1==[206,220].indexOf(parseInt(e))?a&&a[2]&&(t[2]=a[2]&&n?n.replace(new RegExp(a[2],"gi"),""):n,106==e&&t[2]&&(t[2]=t[2].replace(new RegExp("[<>=;]","gi"),""),t[2].includes("#")||(t[2]="#"+t[2]))):t[2]="",i[e]=t.join("|")}let t=getPostParam();v.addClass("d-none"),t.SetPowers=JSON.stringify(i),t.submit1=1,$(document.body).css({cursor:"wait"}),urlPost(url,t).then((function(e){$(document.body).css({cursor:"default"}),e.Err.Save&&doErrorMsg(v,e.Err.Save),e.Err.SetPowers&&(xConfig.obj.arrPow=filterPowers(e.Err),doSuccessMsg(v,'<span data-localize="chats.grpsaved">Your groups powers have been updated</span>'),refreshChat()),e.Err.editgroup&&doLogout(e.Err.editgroup),document.body.scrollIntoView({behavior:"smooth",block:"start"})}))}));let w=$("#checkalldiv");a&&a.on("keyup",(t=>{let a=t.target.value.toLowerCase();return getTotalPowFilter(e.val(),a)})),e&&e.on("change",(function(e){let n=e.target.value;a.val(""),t.addClass("d-none"),w.css("display",""),o.removeClass("d-none");let s=0,r=0,l=0;document.querySelectorAll(".dataSearch").forEach((e=>{let t=e.dataset.notassigned;switch(n){case"asg_una":s++,e.classList.remove("d-none"),w.css("display","");break;case"asg":w.css("display",""),"true"==t?(e.classList.add("d-none"),r++):(e.classList.remove("d-none"),s++);break;case"una":w.css("display","none"),"false"==t?(e.classList.add("d-none"),r++):(e.classList.remove("d-none"),s++)}l++})),0==s&&(t.removeClass("d-none"),w.css("display","none"),o.addClass("d-none")),r+1==l&&w.css("display","none"),updateCheckAll()}))}else $("#tabreturn").click()}))}function updateProgress(e,t){let a=$("#progress"),o=Math.round(e/t*100);a[0].style.cssText="width: "+(0==e?o:o+2)+"%",a.html(e+"/"+t),a.attr("aria-valuenow",o),e>0?a.removeClass("progcol"):a.addClass("progcol"),e>10||0==e?a.removeClass("progtest"):a.addClass("progtest")}function proceedImport(e,t,a){if(!e)return!1;let o,n=$("#gp_list_import"),s=$("#importgpok"),r=$("#gpsuccess"),l=$("#importmodal"),i=$("#gpimperr");if(o=buildGpList(e,t,!1)){let t='<div class="row">';t+=o,t+="</div>",n.html(t),s.removeClass("d-none"),s.off("click").on("click",(function(t){t.preventDefault(),updateFileName(a,!0);let o=$('#gp_list_import input[type="checkbox"]:checked');if(0==o.length)return doErrorMsg(i,'<span data-localize="chats.gpimpsel">You must select at least one power in order to import</span>'),!1;for(let t in o){let a=o[t].id,n=document.getElementById("gi_"+a);206==a?saveLang(e[206]):n&&(n.value=e[a])}l.modal("hide"),doSuccessMsg(r,'<span data-localize="chats.gpimpsuc">Selected group powers have been imported</span>')}))}else l.modal("hide"),doErrorMsg(r,'<span data-localize="chats.gpimpassig">Your group must have assigned at least one power that is included in your import file</span>')}function buildGpList(e,t,a){if(0==Object.keys(e).length)return!1;let o="";for(let n in e)if(void 0!==t[n]){let e=document.getElementById("gi_"+n),s=$("#xatpselect");if(null!==e){if(a&&0==e.value.length)continue;s.addClass("xpspace"),o+='<div class="col-md-4 rngembedpos">',o+='<div class="custom-control custom-checkbox">',o+='<input type="checkbox" class="custom-control-input" id="'+n+'" name="'+n+'" checked="">',o+='<label class="custom-control-label gpcheckafter" for="'+n+'">',o+=t[n].s,o+="</label></div></div>"}}return o}function getTotalPowFilter(e,t){let a=0,o=0,n=0,s=0,r={},l=$("#nopowers"),i=$("#checkalldiv"),c=$("#PowersSubmit");if(document.querySelectorAll(".dataSearch").forEach((t=>{let o=t.dataset.notassigned,n=t.dataset.name,s=t.dataset.id;switch(e){case"asg_una":r[s]=[n,o],a++;break;case"asg":"false"==o&&(r[s]=[n,o],a++);break;case"una":"true"==o&&(r[s]=[n,o],a++)}})),Object.keys(r).length>0){for(let e in r)e.substr(0,t.length)==t||r[e][0].substr(0,t.length)==t?($('[data-id="'+e+'"]').removeClass("d-none"),o>=0&&o--,"true"==r[e][1]?n++:s++):(o++,$('[data-id="'+e+'"]').addClass("d-none")),o==a?(l.removeClass("d-none"),i.css("display","none"),c.addClass("d-none")):(l.addClass("d-none"),i.css("display",""),c.removeClass("d-none"));o+2==a&&i.css("display","none"),n>0&&0==s&&i.css("display","none")}return updateCheckAll(),!0}function getUnassignedPowers(e,t){let a={};for(let o in t)void 0!==e&&null!=e[o]||(a[o]=t[o],a[o].unassigned=!0);return a}function getPowerBase(e,t,a,o,n,s){let r="";return r+='<div class="row form-group customBg '+(s?"unassigrow ":"")+'dataSearch" data-id="'+t+'" data-name="'+e+'" data-notassigned="'+s+'">',r+='<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-2">',r+='<div class="custom-control custom-checkbox">',r+='<input type="checkbox" class="custom-control-input" id="gp_'+t+'" name="gp_'+t+'" '+(s?a:a||o)+">",r+='<label class="custom-control-label '+(s?"noallow ":"")+'gpcheckafter" for="gp_'+t+'">',r+='&nbsp;<img class="gpimage '+(478==t?"gpsuperblastkick":"")+(200==t?"gpspacewar":"")+' " src="https://rxat.ro/images/smw/'+e+'.png" />',r+='<span class="font-weight-bold'+(e.length>=12?" longpow":"")+' ">'+e+" </span>",r+="</label></div>",r+="</div>",r}function handlePowers(e,t,a){let o="";for(let n in e)if("object"==typeof e[n]){let e=t[n],a="disabled",s=e?e.s:n;o+=getPowerBase(s,n,a,"",e,!0),o+='<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-8">',o+='<span class="align-middle"> '+(e?e.d1+' (<a target="_blank" class="nodeco" href="https://util.rxat.ro/wiki/'+s+'">wiki</a>)':""),o+="</span></div>",o+='<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-2">',o+='<a href="https://rxat.ro/powers" target="_blank" class="btn btn-outline-primary btn-sm py-0 getpowmid"><span data-localize="chats.getpwr">Get Power</span></a>',o+="</div>",o+="</div>"}else{let s=e[n].split("|"),r=a[n]||[],l=t[n],i=0==s[0].length?"disabled":"",c=s[1]?"0"==s[1]?"":"checked":"",d=l?l.s:n;if(o+=getPowerBase(d,n,i,c,l,0==s[0].length),o+='<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-'+(""!=i?8:3)+'">',o+='<span class="align-middle"> '+(l?l.d1+' (<a target="_blank" class="nodeco" href="https://util.rxat.ro/wiki/'+d+'">wiki</a>)':""),o+="</span></div>",""==i){let e=s[2]||"";r.length>=3?(o+='<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-5">',null==r[4]?100==n?(o+='<div class="row">',o+='<div class="col-md-2">',o+='<a id="gp_linkmodal" href="#" class="btn btn-primary btn-sm py-0 editmid"><img class="mr-2 editcen" src="'+xConfig.dir+'img/navbar/pencil.svg" alt="edit"><span data-localize="chats.edit">edit</span></a>',o+='</div><div class="col">',o+='<input type="hidden" name="go_'+n+'" class="form-control form-control-sm" id="gi_'+n+'" length="'+r[3]+'" value="'+e+'">',o+="</div></div>"):o+='<input type="text" name="go_'+n+'" class="form-control form-control-sm" id="gi_'+n+'" length="'+r[3]+'" value="'+e+'">':(o+='<a id="gp_modalB" href="#" class="btn btn-primary btn-sm py-0 editmid" data-id="'+n+'"><img class="mr-2 editcen" src="'+xConfig.dir+'img/navbar/pencil.svg" alt="edit"><span data-localize="chats.edit">edit</span></a>',o+='<input type="hidden" style="width:30%" name="go_'+n+'" id="gi_'+n+'" width="50%" length="'+r[3]+'" value="'+escapeHTML(e.replace(/&quot;/g,"'"))+'">'),o+="</div>"):(o+='<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-5">',o+='<input type="hidden" style="width:30%" name="go_'+n+'" id="gi_'+n+'" width="50%" length="256">',o+="</div>")}""!==s[0]?(o+='<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-2">',o+='<a tabindex="0" data-toggle="popover" class="vermid" data-placement="top" data-content="'+s[0]+'"><span class="nosel" data-localize="chats.assignedby" data-toggle="tooltip" data-placement="right" data-html="true" id="copy" title="<span data-localize=\'chats.copy\'>copy</span>!">Assigned by</span></a>',o+="</div>"):(o+='<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-2">',o+='<a href="https://rxat.ro/powers" target="_blank" class="btn btn-outline-primary btn-sm py-0 getpowmid"><span data-localize="chats.getpwr">Get Power</span></a>',o+="</div>"),o+="</div>"}return o}function getTotalAssigned(e){if(!e)return 0;let t=0;for(let a in e){e[a].split("|")[0].length>0&&t++}return t}new SlimSelect({select:"#selecttab",showSearch:!1,closeOnSelect:!0,placeholder:" "});let i=0;function openLinkModal(){let e=document.querySelector("#linkSave"),t=document.querySelector("#errnolink"),a=document.querySelector("#gi_100"),o=document.querySelector("#link_list"),n=document.querySelector("#linkAdd");if(!a)return;let s=a.value.split(",");if(o.innerHTML="",s.length>0&&""!==s[0])for(t.classList.add("d-none"),i=0;i+1<s.length;i+=2)o.appendChild(createLinkField(i,s[i],s[i+1]));else t.classList.remove("d-none");$("#linkModal").modal(),n.removeEventListener("click",addNewField,!1),n.addEventListener("click",addNewField),e.removeEventListener("click",saveLink,!1),e.addEventListener("click",saveLink)}function saveLink(e){let t=[],a=document.querySelector("#gi_100"),o=document.querySelectorAll("[data-row]");o.length>0&&o.forEach((function(e){let a=e.dataset,o=document.getElementById("name_"+a.rid).value,n=document.getElementById("value_"+a.rid).value;o.length&&n.length&&(t.push(o),t.push(n))})),a.value=t.join(",")}function addNewField(e){let t=document.querySelector("#link_list"),a=document.querySelector("#errnolink");e.preventDefault(),i+=1,t.appendChild(createLinkField(i,"","")),a.classList.add("d-none")}function createLinkField(e,t,a){let o=document.querySelector("#errnolink"),n=document.createElement("div");n.className="row mb-4",n.setAttribute("data-rid",e),n.setAttribute("data-row","");let s=document.createElement("div");s.className="col-md-5",n.appendChild(s);let r=document.createElement("input");r.type="text",r.id="name_"+e,r.className="form-control",r.value=t,s.appendChild(r);let l=document.createElement("div");l.className="col-md-5",n.appendChild(l);let i=document.createElement("input");i.type="text",i.id="value_"+e,i.className="form-control",i.value=a,l.appendChild(i);let c=document.createElement("div");c.className="col-md-2",n.appendChild(c);let d=document.createElement("div");return d.setAttribute("data-id",e),d.className="imglink",d.style.background="url('"+xConfig.dir+"img/navbar/remove.svg')",c.appendChild(d),d.addEventListener("click",(t=>{let a=document.querySelector('[data-rid="'+e+'"]');a&&a.remove(),0==linkCount()&&o.classList.remove("d-none")})),n}function linkCount(){return document.querySelectorAll("[data-rid]").length}let flagsList={NoList:512,members:128,registered:1048576,subscribers:1048576,NoStore:256,FussyBan:4194304,NoSmilieLine:2048,DefNoSound:131072,Transparent:65536,UseHtml5:67108864};function handleAppearanceTab(){$("#landscape").parent().parent().removeClass("d-none");let e=xConfig.obj,t=e.Err,a=$("#appearance #AppearanceSubmit"),o=void 0===t.background?[]:t.background.split(";="),n=void 0===t.www?[]:t.www.split(";="),s=formatAppearanceAndApply(e)[0],r=$("#gbackground"),l=$("#button0"),i=$("#cbackground"),c=$("#button1"),d=$("#css");t.flags&flagsList.Transparent?(i.attr("disabled",!0),c.attr("disabled","disabled"),c.children().css("opacity","0.2"),c.tooltip("dispose"),c.removeClass("transButton"),createTooltips(i.parent(),'<span data-localize="chats.transblock">This field cannot be used while the transparent option is enabled in settings</span>')):(i.parent().tooltip("dispose"),i.removeAttr("disabled"),c.children().css("opacity","1"),c.addClass("transButton"),c.tooltip()),0===pickersList.length&&initColorsPickers(),d.on("keyup",(function(e){if(r.attr("disabled")&&0===e.target.value.length){if(r.removeAttr("disabled"),l.removeAttr("disabled"),l.children().css("opacity","1"),"#"===r.val().charAt(0)&&7===r.val().length){let e=isColorLight(r.val());r.css({"background-color":r.val(),color:e?"#001":"#FFF"})}r.parent().tooltip("dispose"),l.addClass("transButton"),l.tooltip()}!r.attr("disabled")&&e.target.value.length>=1&&(r.attr("disabled",!0),l.attr("disabled",!0),l.children().css("opacity","0.2"),r.val(""),r.css({"background-color":"",color:"#001"}),l.tooltip("dispose"),l.removeClass("transButton"),createTooltips(r.parent()))}));getPostParam();let u=$("#apperr");a.off("click").on("click",(function(e){e.preventDefault();let a=getPostParam();for(let e in s){let t=$("#appearance #"+e);if(t)switch(s[e]=t.val(),e){case"css":case"gbackground":case"iframe":s.css&&s.css.length>1?n[1]=s.css:"#"===s.gbackground.charAt(0)?n[1]=filter(s.gbackground):n[1]=s.gbackground,n[2]=filter(s.iframe)||"",a.www=n.join(";=");break;case"portrait":case"landscape":case"buttoncolor":case"cbackground":"cbackground"===e&&(o[0]=filter(s[e])),"portrait"===e&&s[e].length>0&&(o[6]=filter(s[e])),"portrait"===e&&0==s[e].length&&(o[6]=""),"landscape"===e&&s[e].length>0&&(o[7]=filter(s[e])),"landscape"===e&&0==s[e].length&&(o[7]=""),"buttoncolor"===e&&(o[5]=filter(s[e])),a.background=o.join(";=")}}if(s.iframe.length>0&&!s.gbackground.length){let e="<span data-localize='chats.bgififrame'>You must also set an outer group background when adding a xatframe</span>";e+="<span class='alerttab text-secondary'><span data-localize='chats.note'>NOTE</span>: <span data-localize='chats.remcss'>If you use custom CSS, you must remove it first to edit the outer background field.</span></span>",doErrorMsg(u,e),document.body.scrollIntoView({behavior:"smooth",block:"start"})}else u.addClass("d-none"),a.tags=t.tags,a.descrip=filter(t.descrip),a.Lang=t.Lang,a.submit1=1,$(document.body).css({cursor:"wait"}),urlPost(url,a).then((function(e){if($(document.body).css({cursor:"default"}),e.Err.Save&&doErrorMsg(u,e.Err.Save),e.Err.SaveAppearanceOk){let t='<span data-localize="chats.appsaved">Your appearance settings have been updated</span>';formatAppearanceAndApply(e,!0)[1]>=1&&(t+='<span class="alerttab text-danger"><span data-localize="chats.note">NOTE</span>: <span data-localize="chats.blockedlinks">Some of your links have been blocked by xat.</span> ',t+='<a target="_blank" href="https://util.rxat.ro/wiki/Images">',t+='<span data-localize="chats.permittedimg">See permitted image providers</span>.</a></span>'),doSuccessMsg(u,t),refreshChat()}e.Err.editgroup&&doLogout(e.Err.editgroup),xConfig.obj.Err=updateConfigObj(Object.assign({},a,e.Err)),document.body.scrollIntoView({behavior:"smooth",block:"start"})}))}))}function formatAppearanceAndApply(e,t){if(!e.Err)return{};let a=e.Err,o=$("#gbackground"),n=$("#button0"),s=$("#css"),r=void 0===a.background?[]:a.background.split(";="),l=void 0===a.www?[]:a.www.split(";="),i={buttoncolor:r[5],cbackground:r[0],portrait:r[6],landscape:r[7],css:"",gbackground:"",iframe:""};if(l[1])if("http"===l[1].substr(0,4)||""===l[1]||"#"===l[1].charAt(0)){if(i.gbackground=l[1].replace(/=/gi,""),i.gbackground.indexOf("GetImage7")>=0){let e=i.gbackground.split("?U")[1];i.gbackground=e}}else i.css=l[1];l[2]&&(i.iframe=l[2]);let c=0;for(let e in i){let a=document.querySelector("#appearance #"+e);t&&i[e]&&i[e].indexOf("//BlockedDomain")>=0&&c++,a&&("buttoncolor"===e&&(a.value=i[e]),"css"===e&&i.css.length>=1?(s.val(i[e]),o.attr("disabled",!0),n.attr("disabled","disabled"),n.children().css("opacity","0.2"),n.tooltip("dispose"),n.removeClass("transButton"),createTooltips(o.parent()),updateCharCount(i[e].length),o.value=""):a.value=i[e]||"")}return[i,c]}function createTooltips(e,t){t||(t='<span data-localize="chats.disabled">Remove content in custom CSS to use this field</span>'),e&&(e.attr("data-toggle","tooltip"),e.attr("data-placement","top"),e.attr("data-html",!0),e.attr("title",t),initToolTip(e))}let selectSettings=new SlimSelect({select:"#chatlang",showSearch:!0,closeOnSelect:!0,placeholder:" ",searchPlaceholder:" ",searchFocus:!1});function handleSettingsTab(){let e=xConfig.obj,t=e.Err,a=void 0===t.background?[]:t.background.split(";="),o=$("#SettingsSubmit"),n=$("#setsuccess"),s=formatSettingsAndApply(e)[0],r=flagsList.members|flagsList.subscribers,l=!1;(t.flags&r)==r&&($('input[name="subscribers"]').prop("checked",!0),l=!0);for(let e in flagsList)"subscribers"!=e&&(["members","registered"].indexOf(e)>=0&&!l&&t.flags&flagsList[e]&&$('input[name="'+e+'"]').prop("checked",!0),-1==["members","registered"].indexOf(e)&&t.flags&flagsList[e]&&$('input[name="'+e+'"]').prop("checked",!0));o.off("click").on("click",(function(e){e.preventDefault();let o=getPostParam(),l={},i=66,c=$('input[name="subscribers"]').is(":checked");c&&(i|=r);for(let e in flagsList)if("subscribers"!==e){let t=$('input[name="'+e+'"]').is(":checked");if(["members","registered"].indexOf(e)>=0){if(c&&t&&$('input[name="'+e+'"]').prop("checked",!1),"registered"==e&&t){$('input[name="members"]').is(":checked")&&$('input[name="members"]').prop("checked",!1)}!c&&t&&(i|=flagsList[e])}-1==["members","registered"].indexOf(e)&&t&&(i|=flagsList[e])}for(let e in s){let t=$("#settings "+("Lang"!=e?'input[name="'+e+'"]':'select[name="'+e+'"]'));if(t)switch(s[e]=t.val(),e){case"Tags":let e=s.Vars.split(";="),t=$("#settings #chatlang option:selected").val();e[0]=t,s.Vars=e.join(";="),l.tags=[filter(s.Tags),s.Vars].join(";="),l.Lang=t;break;case"GroupName":o.name=filter(s.GroupName);break;case"GroupDescription":l.descrip=filter(s.GroupDescription)}}i&flagsList.Transparent&&(a[0]="");let d=filter(s.Buddy);a[3]=$("#settings #chatlang option:selected").text().split(" /")[0],a[4]=filter(s.Radio),l.background=a.join(";="),n.addClass("d-none"),o.background=l.background,o.tags=l.tags,o.descrip=l.descrip,o.Lang=l.Lang,o.www=t.www,o.SetFlags=i,o.SetBuddy=d,o.submit1=1,$(document.body).css({cursor:"wait"}),urlPost(url,o).then((function(e){$(document.body).css({cursor:"default"});let t=$("#setsuccess");if(e.Err.Save&&doErrorMsg(t,e.Err.Save),e.Err.SaveSettingsOk){let a='<span data-localize="chats.appsaved">Your settings have been updated</span>';formatSettingsAndApply(e,!0)[1]>=1&&(a+='<span class="alerttab text-danger"><span data-localize="chats.note">NOTE</span>: <span data-localize="chats.blockedlinks">Some of your links have been blocked by xat.</span> ',a+='<a target="_blank" href="https://util.rxat.ro/wiki/Images">',a+='<span data-localize="chats.permittedimg">See permitted image providers</span>.</a></span>'),doSuccessMsg(t,a),refreshChat()}e.Err.editgroup&&(isValidGroup(s.GroupName)?doLogout(e.Err.editgroup):(doErrorMsg(t,"<span data-localize=chats.nonewgrp>Cannot change group name. Reverted to original name.</span> <span data-localize=chats.caseonly>You can change case only</span>."),$("#settings #gname").val(xConfig.obj.GroupName))),xConfig.obj.Err=updateConfigObj(Object.assign({},o,e.Err)),document.body.scrollIntoView({behavior:"smooth",block:"start"})}))}))}function isValidGroup(e){if(!e)return!1;let t=xConfig.obj.GroupName;return!!t&&t.toLowerCase()==e.toLowerCase()}function formatSettingsAndApply(e,t){if(!e.Err)return{};let a=e.Err,o=void 0===a.tags?[]:a.tags.split(";="),n=void 0===a.background?[]:a.background.split(";="),s={Tags:o[0],GroupName:a.name,GroupDescription:a.descrip,Vars:[o[1],o[2]].join(";="),Lang:o[1],Radio:n[4],Buddy:n[1]||""},r=0;for(let e in s){let a="Lang"!==e?'input[name="'+e+'"]':'select[name="'+e+'"]',o=document.querySelector("#settings "+a);t&&s[e]&&s[e].indexOf("//BlockedDomain")>=0&&r++,o&&("Lang"===e?selectSettings.set(s.Lang):o.value=s[e]||"")}return[s,r]}function updateFileName(e,t,a){var o=t?"":e.val().split("\\").pop();o=filter(o);let n=e.siblings(".custom-file-label").html();t?o=e.data("html")||"":e.attr("data-html",n),e.siblings(".custom-file-label").addClass("selected").html(o),a&&a.addClass("d-none")}$(".ss-search").append('<div class="holder" data-localize="chats.search">search</div>'),$(".ss-search").parent().children().find("input").addClass("gpsearch");let mainSelect=new SlimSelect({select:"#multiple",showSearch:!1,closeOnSelect:!1,placeholder:" ",searchPlaceholder:" ",searchFocus:!1});function DoMainOwners(){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();Reset(),$("#mainowners").removeClass("d-none");xConfig.obj;let e=getPostParam();if(hasPower(598)?mainSelect.enable():mainSelect.disable(),e.GetMains=1,void 0!==xConfig.obj.Err.mainsList)return loadMainOwners();$(document.body).css({cursor:"wait"}),urlPost(url,e).then((function(e){return $(document.body).css({cursor:"default"}),e.Err.mains&&(xConfig.obj.Err.mainsList=e.Err.mains),loadMainOwners()}))}let permissions={1:"appearance",2:"tabs",4:"settings",8:"group_powers"};function loadMainOwners(e){let t=xConfig.obj,a=null==t.Err.mainsList?{}:clearBadUser(t.Err.mainsList[0]),o=($("#mainowners #add"),$("#mainOwnersList")),n=($("#mainOwnersList #remove"),$("#mainerr")),s=$(".mainownerstable"),r=$("#errnomain"),l="",i=1;if(Object.keys(a).length>0){for(let e in a){if(l+="<tr>",l+='<th scope="row">'+i+"</th>",l+="<td>"+a[e][1]+"</td>",l+="<td>",-1==a[e][0])l+=getPermTranslate("appearance, tabs, settings, group powers").slice(0,-1);else{let t="";for(let o in permissions)a[e][0]&o&&(t+=getPermTranslate(permissions[o])+", ");l+=t.slice(0,-2)}l+="</td>",l+='<td><a id="remove" data-id="'+e+'" href="#"><img class="remsvg nosel" data-id="'+e+'" src="'+xConfig.dir+'img/navbar/remove.svg" alt="remove"></a></td>',l+="</tr>",i++}r.html(""),r.addClass("d-none"),s.removeClass("d-none")}else r.html('<span data-localize="chats.mainzero">You do not have any main owners currently</span>'),r.removeClass("d-none"),r.addClass("proglab"),s.addClass("d-none");o.html(l),localize(["chats"]),document.querySelectorAll("#remove").forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault();let t=$("#remmainmodal"),o=$("#mainbye"),s=e.target.dataset.id;if(!s)return!1;t.modal(),o.off("click").on("click",(function(e){e.preventDefault();let o=findInList(a,s);if(o){delete a[s];let e=getPostParam(),n=$("#mainerr");a=returnTrueMains(a),n.addClass("d-none"),e.SetMains=JSON.stringify(a),xConfig.obj.Err.mains=JSON.stringify(a),$(document.body).css({cursor:"wait"}),urlPost(url,e).then((function(e){if($(document.body).css({cursor:"default"}),t.modal("hide"),!e.Err.editgroup){xConfig.obj.Err.mainsList=e.Err.mains;let t=o[1]||s;return doSuccessMsg(n,'<span class="font-weight-bold">'+t+'</span> <span data-localize="chats.mainremsuc">has been removed</span>'),loadMainOwners(!0)}doErrorMsg(n,e.Err.editgroup)}))}else doErrorMsg(n,'<span data-localize="chats.mainnofound">User has not been found in the list</span>')}))}))})),$("#mainyes").off("submit").submit((function(e){e.preventDefault();let t=$("#mainuserid"),o=($('select[name="permissions"]'),$('select[name="permissions"] option:selected')),s=-1;if(o.length>0){s=0;for(let e in o){let t=o[e].value;null!=t&&null!=permissions[t]&&(s|=t)}}let r=!1,l=filter(t.val());if(0==l.length)return void doErrorMsg(n,'<span data-localize="chats.mainusid">You must add a username/id</span>');if(r=findInList(a,l),r){if(-1==r[0]&&-1==s)return doErrorMsg(n,'<span data-localize="chats.mainallsame">You cannot add the same user again</span>'),!1;if(r[0]==s)return doErrorMsg(n,'<span data-localize="chats.mainpersame">You cannot add the same user with same permissions</span>'),!1}isNaN(l)&&(l=l.toLowerCase()),a[l]=0==s?-1:s,a=returnTrueMains(a);let i=getPostParam();n.addClass("d-none"),i.SetMains=JSON.stringify(a),xConfig.obj.Err.mains=JSON.stringify(a),$(document.body).css({cursor:"wait"}),urlPost(url,i).then((function(e){if($(document.body).css({cursor:"default"}),e.Err.mains){let o=e.Err.mains;t.val(""),mainSelect.set([]),xConfig.obj.Err.mainsList=e.Err.mains;let s=l;if(!isNaN(l)){let t=findInList(e.Err.mains[0]||{},l);s=t&&t[1].length>0?t[1]:l}return o[1]?doErrorMsg(n,'<span data-localize="chats.mainnomain">This user does not exist</span>'):r?-1==a[l]?doSuccessMsg(n,'<p data-localize="chats.mainallupd">Main owner has been updated with all permissions</p><span data-localize="chats.capuser">Username</span>: <span class="font-weight-bold"> '+s+"</span>"):doSuccessMsg(n,'<p data-localize="chats.mainperupd">Main owner has been updated with new permissions</p><span data-localize="chats.capuser">Username</span>: <span class="font-weight-bold"> '+s+"</span>"):doSuccessMsg(n,'<p data-localize="chats.mainadded">New main owner has been added</p><span data-localize="chats.capuser">Username</span>: <span class="font-weight-bold"> '+s+"</span>"),loadMainOwners()}{let t=e.Err.Save||'<span data-localize="chats.maintoomany">You have too many main owners</span>';t=e.Err.editgroup||t,doErrorMsg(n,t)}}))}))}function clearBadUser(e){if(0==Object.keys(e).length)return{};for(let t in e)Array.isArray(e[t])||delete e[t];return e}function getPermTranslate(e){if(!e)return"";let t="";if(e.indexOf(", ")>=0){e=e.split(", ");for(let a in e)t+=getPermTranslate(e[a])+(parseInt(a)+1==e.length?"":", ");return t}return'<span data-localize="chats.'+e.replace("_","").replace(" ","")+'">'+(e=e.replace("_"," "))+"</span>"}function findInList(e,t){if(!e)return!1;for(let a in e){if(a==t)return e[a];if(Array.isArray(e[a])&&e[a][1].toLowerCase()==t.toLowerCase())return e[a]}return!1}function returnTrueMains(e){if(!e)return!1;let t={};for(let a in e)Array.isArray(e[a])?t[a]=e[a][0]:t[a]=e[a];return t}function DoReturn(e){Reset(),$("#editgroup").addClass("d-none"),$("#editgroup_edit").addClass("d-none"),$("#mainNav").removeClass("d-none"),$("#tabreturn").removeClass("active");let t=e||"editgroup";location.hash="#!"+doRealHash(location.hash,t),e||window.location.reload(!0)}function doForgotPassword(){$("#lostpwmodal").modal(),$("#SubmitLost").off("click").click((function(e){e.preventDefault(),allErrsOff();let t=$("#lostpwmodal #emailLP").val(),a={},o=getGET().params.GroupName||$("#GroupNameI").val();a.name=filter(o),a.email=filter(t),a.SubmitLost=1,$(document.body).css({cursor:"wait"}),urlPost(url,filter(a)).then((function(e){$(document.body).css({cursor:"default"}),allErrsOff();let t=$("#editgrouperr"),a=$("#forgotpasserr");if(e.Err.forgotpassok)return $("#lostpwmodal").modal("hide"),void $("#lostpwmodal").off("hidden.bs.modal").on("hidden.bs.modal",(function(){doSuccessMsg(t,e.Err.forgotpassok),$(this).find("form").trigger("reset")}));e.Err.editgroup?doErrorMsg(a,e.Err.editgroup):doErrorMsg(a,e.Err.forgotpass)}))}))}let defaultwidth=650,defaultheight=486,update=null;function doEmbed(){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();$("#embedmodal").modal();let e=xConfig.obj,t=$("#embed_width"),a=$("#embed_height"),o=$("#embed_code"),n=($(".rngembed"),$("#copy")),s=$(".toembed button"),r=0,l=0;a.val(defaultheight),t.val(defaultwidth),o.html(getEmbed(e.GroupName,e.Err.roomid,e.Err.width,e.Err.height)),s.off("click").on("click",(function(n){switch(n.preventDefault(),n.target.id){case"embsmall":r=400,l=300;break;case"embmedium":r=540,l=405;break;case"emblarge":r=640,l=480}a.val(l),t.val(r),o.html(getEmbed(e.GroupName,e.Err.roomid,r,l))})),t.off("keyup").on("keyup",(function(n){clearTimeout(update),update=setTimeout((function(){let s=n.target.value;(isNaN(s)||s>2e3||s<400)&&(s=defaultwidth,t.addClass("inpshake"),setTimeout((function(){t.removeClass("inpshake")}),1e3)),s=parseInt(s),r=s,l=calculateProp(s,!1),t.val(r),a.val(l),o.html(getEmbed(e.GroupName,e.Err.roomid,s,0==l?a.val():l))}),1e3)})),a.off("keyup").on("keyup",(function(n){clearTimeout(update),update=setTimeout((function(){let s=n.target.value;(isNaN(s)||s>2e3||s<400)&&(s=defaultheight,a.addClass("inpshake"),setTimeout((function(){a.removeClass("inpshake")}),1e3)),s=parseInt(s),l=s,r=calculateProp(s,!0),a.val(l),t.val(r),o.html(getEmbed(e.GroupName,e.Err.roomid,0==r?t.val():r,s))}),1e3)})),t.off("keydown").on("keydown",(function(e){clearTimeout(update)})),a.off("keydown").on("keydown",(function(e){clearTimeout(update)})),n.tooltip({trigger:"click",placetop:"top"}),n.off("click").on("click",(function(e){e.preventDefault();var t=document.getElementById("embed_code");t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),n.tooltip("show"),setTimeout((function(){n.tooltip("hide")}),1e3),localize(["chats"])})),$("#preview").off("click").on("click",(function(o){r=r||t.val(),l=l||a.val();let n=e.GroupName,s=e.Err.roomid;r<=650&&getEmbed(n,s,r,l,!0),r>650&&getEmbed(n,s,r,l,!1,!0)}))}function loadModal(e,t){if(!e)return!1;xConfig.obj;fetch("https://rxat.ro/web_gear/chat/GroupOptionEdit2.php?j=2&id="+e).then((function(e){return e.json()})).then((function(a){var o=a.Options[e];let n="";for(let e in o){if(n+='<div class="row editrspace">',n+='<div class="col-md-6"><label class="col-form-label form-control-sm laleft">'+o[e][0]+"</label></div>",n+='<div class="col-md-6 edcol checkspfix">',Array.isArray(o[e][2]))if(null!=o[e][3])for(let t=0;t<o[e][2].length;t++){let a="";o[e][1]&1<<t&&(a="checked"),n+='<div class="row editrspace">',n+='<div class="col-lg-2">',n+='<div class="custom-control custom-checkbox">',n+='<input type="checkbox" class="custom-control-input" id="'+["idc",e,t].join("_")+'" '+a+" />",n+='<label class="custom-control-label cursoric wifix" for="'+["idc",e,t].join("_")+'">'+(o[e][2][t]||"")+"</label>",n+="</div>",n+="</div>",n+="</div>"}else{n+='<select class="form-control form-control-sm" id="'+["ids",e].join("_")+'">';for(let t=0;t<o[e][2].length;t++){let a=o[e][2][t];n+='<option value="'+t+'" '+(t==o[e][1]?" selected":"")+">"+a+"</option>"}n+="</select>"}else if(null!=o[e][2])n+='<input type="text" class="form-control form-control-sm" value="'+(o[e][1]||"")+'" id="'+["idt",e].join("_")+'">';else{n+='<select class="form-control form-control-sm" id="'+["ids",e].join("_")+'">';for(let t in a.Status){let s=a.Status[t]==o[e][1]?" selected":"";n+='<option value="'+a.Status[t]+'" '+s+">"+t+"</option>"}n+="</select>"}n+="</div></div>"}let s={},r={},l={};for(let t in o)l[t]=o[t][1],null==o[t][2]&&206!=e||(s[t]=o[t][2]),null!=o[t][3]&&(r[t]=o[t][3]);if(206==e||220==e){l={};for(let t in o){let a="";220==e&&("cv"==t&&(a=3),"rgd"==t&&(a=3)),l[t]=206==e?"":a}}let i=$("#gp_content"),c=$("#modalGp"),d=$("#gp_title");if(i.html(n),d.html("<span data-localize='chats.edit'>edit</span> "+t),206==e){let t=getPostParam();t.GetLang=1,$(document.body).css({cursor:"wait"}),urlPost(url,t).then((function(t){$(document.body).css({cursor:"default"});let a="{}";t.Err.Lang&&(a=JSON.stringify(t.Err.Lang)),document.getElementById("gi_206").value=a,Load(e,l,s,r),c.modal()}))}else Load(e,l,s,r),c.modal();$("#gp_ok").off("click").click((function(t){t.preventDefault(),changeParent(e,l,s,r),206==e&&saveLang(),c.modal("hide")})),$("#gp_default").off("click").click((function(e){e.preventDefault(),setDefault(l)})),localize(["chats"])}))}function saveLang(e){if(!xConfig.obj||null==xConfig.obj.password||null==xConfig.obj.TokenKey)return $("#tabreturn").click();xConfig.obj;let t=getPostParam();if(e)t.SetLang=e;else{let e=document.getElementById("gi_206");t.SetLang=e.value||"{}"}$(document.body).css({cursor:"wait"}),urlPost(url,filter(t)).then((function(e){$(document.body).css({cursor:"default"})}))}function changeParent(e,t,a,o){var n,s,r,l=0,i=0;for(n in t){for(r=0;r<8&&(s=document.getElementById("idc_"+n+"_"+r));r++)l=1,s.checked&&(i|=1<<r);l&&((i&=o[n])==t[n]?delete t[n]:t[n]=filter(i),l=0),(s=document.getElementById("idt_"+n))&&(s.value==t[n]?delete t[n]:o[n]?(t[n]=filter(parseFloat(s.value)),isNaN(s.value)?delete t[n]:o[n]&&(t[n]>parseFloat(o[n])&&(t[n]=o[n]),t[n]<parseFloat(a[n])&&(t[n]=a[n]))):t[n]=filter(s.value)),(s=document.getElementById("ids_"+n))&&(s[s.selectedIndex].value==t[n]?delete t[n]:t[n]=s[s.selectedIndex].value)}document.getElementById("gi_"+e).value=JSON.stringify(t)}function escapeHTML(e){return null==e?"":e.replace(/"/g,"&quot;")}function Load(e,t,a,o){var n,s,r,l=document.getElementById("gi_"+e);try{var i=JSON.parse(l.value)}catch(e){i={}}for(n in t){for(null==i[n]&&(i[n]=t[n]),r=0;r<8&&(s=document.getElementById("idc_"+n+"_"+r));r++)s.checked=i[n]&1<<r;if((s=document.getElementById("idt_"+n))&&(s.value=i[n]),s=document.getElementById("ids_"+n))for(var c=0;c<s.length;c++)s[c].value==i[n]&&(s.selectedIndex=c)}}function setDefault(e){var t,a,o;for(t in e){for(o=0;o<8&&(a=document.getElementById("idc_"+t+"_"+o));o++)a.checked=e[t]&1<<o;if((a=document.getElementById("idt_"+t))&&(a.value="undefined"==e[t]?"":e[t]),a=document.getElementById("ids_"+t))for(var n=0;n<a.length;n++)a[n].value==e[t]&&(a.selectedIndex=n)}}function updateConfigObj(e){let t=xConfig.obj.Err;if(t.background=e.background,void 0!==e.Lang&&(t.Lang=e.Lang),t.www=e.www,t.tags=e.tags,t.descrip=e.descrip,void 0!==e.flags&&(t.flags=e.flags),void 0!==e.SetFlags&&(t.flags=e.SetFlags),void 0!==e.SetBuddy){let a=e.background.split(";=");a[1]=e.SetBuddy,t.background=a.join(";=")}return t}function refreshToken(e){let t=xConfig.obj,a=t.TokenKey.split(".");return a[2]&&(a[2]=e),t.TokenKey=a.join("."),t.TokenKey}function getUserId(){return xConfig.id?xConfig.id:0}function getPostParam(){let e=xConfig.obj,t=getTodo();t&&(t=JSON.parse(t));let a={};return a.name=e.GroupName,a.password=e.password,a.TokenKey=e.TokenKey,a.MainOwner=getUserId(),a.DeviceId=t&&t.DeviceId||"",a.PassHash=t&&t.PassHash||"",filter(a)}function refreshChat(){let e=getPostParam();e.RefreshChat=1,$(document.body).css({cursor:"wait"}),urlPost(url,e).then((function(e){$(document.body).css({cursor:"default"})}))}function initColorsPickers(){let e={theme:"nano",useAsButton:!0,closeOnScroll:!0,swatches:null,lockOpacity:!0,components:{palette:!0,preview:!0,opacity:!0,hue:!0,interaction:{save:!0,input:!0}}};for(let t=0;t<=4;t++)if(e.el="#button"+t,$("#button"+t).length){pickersList[t]=Pickr.create(e),pickersList[t].id="button"+t;let a=getIDFromButton(pickersList[t].id);if(a){let e=$("#"+a);if(e){let t=e.val();if("#"==t.charAt(0)&&7==t.length){let a=isColorLight(t);e.css({"background-color":t,color:a?"#000":"#FFF"})}e.off("keyup").on("keyup",(function(){let t=$(this).val();if("#"!==t.charAt(0)||"#"==t.charAt(0)&&7!==t.length)e.css({"background-color":"",color:"#001"});else{let a=isColorLight(t);e.css({"background-color":t,color:a?"#000":"#FFF"})}}))}}pickersList[t].on("save",((e,t)=>{if(a){let t=$("#"+a),o=e.toHEXA().toString(),n=isColorLight(o);t.css({"background-color":o,color:n?"#000":"#FFF"}),t.val(o)}})),pickersList[t].on("show",((e,o)=>{if(a){let e=$("#"+a);if(e.prop("disabled"))return void pickersList[t].hide();pickersList[t].setColor(e.val())}}))}}function getIDFromButton(e){if(!e)return!1;switch(e){case"button0":return"gbackground";case"button1":return"cbackground";case"button2":return"buttoncolor";case"button3":return"portrait";case"button4":return"landscape"}}function isColorLight(e){var t,a,o;return!!e&&(e.match(/^rgb/)?(t=(e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],a=e[2],o=e[3]):(t=(e=+("0x"+e.slice(1).replace(5>e.length&&/./g,"$&$&")))>>16,a=255&e>>8,o=255&e),127.5<Math.sqrt(t*t*.299+a*a*.587+o*o*.114))}function filterPowers(e){if(!e)return[];let t={},a=e.Powers||e.SetPowers;if(!a)return[];for(let e in a){let o=a[e].split("|");o[0].length>0&&1==o[1]&&(t[e]=1)}return t}function hasPower(e){if(!e)return!1;let t=xConfig.obj.arrPow;return!!t&&null!=t[e]}function updateTabs(){let e=xConfig.obj.Err.mains,t=xConfig.id;if(!e||!t)return;if(e=JSON.parse(e),null==e[t])return;let a=e[t],o=[],n=!0;if(-1!==a)for(let e in permissions){let t=permissions[e].replace(/_/gi,"");0==(a&e)?("appearance"==t&&(n=!1),$("#tab"+t).hide(),$("#"+t).remove()):o.push("tab"+t)}$("#tabmainowners").hide(),$("#mainowners").remove(),$("#tabmiscellaneous").hide(),$("#miscellaneous").remove(),n||o.length>0&&setTimeout((()=>{$("#"+o[0]).click()}),0)}function getTodo(){return localStorage.getItem("todo")}function enablePreview(){if(null==xConfig.obj.GroupName)return!1;$("#SettingsPreview, #AppearancePreview, #TabsPreview").off("click").on("click",(function(e){window.open("//rxat.ro/"+xConfig.obj.GroupName+"?new&preview=true&cb="+Math.floor(Date.now()/1e3),"preview","toolbar=1,resizable=1,scrollbars=1")}))}function doLogout(e){DoReturn("editgroup"),DoTask("editgroup"),doErrorMsg($("#editgrouperr"),e)}function initSlimSeletect(e){for(let t in e)slimList[e[t]]=new SlimSelect({select:"#"+e[t],showSearch:!0,closeOnSelect:!0,placeholder:" ",searchPlaceholder:" ",searchFocus:!1})}function initToolTip(e){var t=[];if(e)e.tooltip(),t.push(setTranslateDiv(e[0]||e,"tooltips"));else{$('[data-toggle="tooltip"]').tooltip({trigger:"hover"});let e=document.querySelectorAll('[data-toggle="tooltip"]');e.length>0&&e.forEach((function(e){t.push(setTranslateDiv(e,"tooltips"))}))}t.length>0&&"en"!==xConfig.lang&&(localize(["chats"]),updateNodeTranslate(t))}function initPopover(){let e=$(".vermid");e.popover({trigger:"hover"}),e.off("click").on("click",(function(e){e.preventDefault();let t=e.target.dataset;if(!t.content&&(t=e.target.parentNode.dataset,!t.content))return;let a=t.content.replace(/:/g," ");var o=document.createElement("textarea");o.value=a,o.style.top="0",o.style.left="0",o.style.position="fixed",document.body.appendChild(o),o.focus(),o.select(),document.execCommand("copy"),document.body.removeChild(o)})),$(".nosel").tooltip(),localize(["chats"])}var didQuery=!1;function handlePopover(){if($('[data-toggle="popover"]').popover({trigger:"focus",html:!0}),!didQuery){let t=document.querySelectorAll('[data-toggle="popover"]');if(t.length>0){var e=[];t.forEach((function(t){e.push(setTranslateDiv(t,"popover"))})),e.length>0&&"en"!==xConfig.lang&&(localize(["chats"]),updateNodeTranslate(e))}didQuery=!0}}function setTranslateDiv(e,t){let a,o,n=e.dataset;if(n&&!e.contains(document.getElementById(t))){let s=document.createElement("div");return e.appendChild(s),n.content&&(a=createElement(s,"div","content"),a.innerHTML=n.content),n.originalTitle&&(o=createElement(s,"div","originalTitle"),o.innerHTML=n.originalTitle),s.id=t,s.className="d-none",[e,a,o]}}function updateNodeTranslate(e){if(!e)return!1;for(let t in e)e[t][1]&&e[t][0].setAttribute("data-content",e[t][1].innerHTML),e[t][2]&&e[t][0].setAttribute("data-original-title",e[t][2].innerHTML)}function createElement(e,t,a){let o=document.createElement(t);return o.id=a,e.appendChild(o),o}function SafeImage(e){if(0==e.length)return"";var t=parse_url(e);return(t||(t=parse_url(e="/"==e.charAt(0)?"https:"+e:"https://"+e)))&&t.host?0<=t.host.indexOf("rxat.ro")&&0<t.path.indexOf("GetImage")?e:"/web_gear/chat/GetImage7.php?U="+e:""}function parse_url(e,t){for(var a=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],o={},n=o["phpjs.parse_url.mode"]&&o["phpjs.parse_url.mode"].local_value||"php",s={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},r=s[n].exec(e),l={},i=14;i--;)r[i]&&(l[a[i]]=r[i]);if(t)return l[t.replace("PHP_URL_","").toLowerCase()];if("php"!==n){var c=o["phpjs.parse_url.queryKey"]&&o["phpjs.parse_url.queryKey"].local_value||"queryKey";s=/(?:^|&)([^&=]*)=?([^&]*)/g,l[c]={},(l[a[12]]||"").replace(s,(function(e,t,a){t&&(l[c][t]=a)}))}return delete l.source,l}function initStuff(){$("a.btn").on("click",(function(e){e.preventDefault()})),handlePopover(),$("#checkall").off("click").on("click",(function(){$(this).is(":checked")?$("#grouppowers .custom-control-input").each((function(){let e=$(this).closest(".dataSearch");0!=$(this).is(":disabled")||e.hasClass("d-none")||$(this).prop("checked",!0)})):$("#grouppowers .custom-control-input").each((function(){let e=$(this).closest(".dataSearch");0!=$(this).is(":disabled")||e.hasClass("d-none")||$(this).prop("checked",!1)}))})),$("textarea").keyup((function(){updateCharCount($(this).val().length)})),document.querySelectorAll(".PassReveal").forEach((e=>{e.addEventListener("click",(e=>{PassReveal($(e.target))}))})),$('a[data-toggle="tab"]').on("shown.bs.tab",(function(e){var t=e.target.attributes.href.value;$(t+" input").focus()})),$(".gpsearch, .holder").on("focus",(function(e){$(".holder").hide()})),$(".gpsearch, .holder").on("blur",(function(e){0==$(this).val().length&&$(".holder").show()}))}function updateCheckBoxState(){updateCheckAll(),$("#grouppowers .dataSearch .custom-control-input").off("click").on("click",(function(e){updateCheckAll()}))}function updateCheckAll(){$("#grouppowers .dataSearch .custom-control-input:checked").length;0==$("#grouppowers .dataSearch .custom-control-input").not(":checked, :disabled").length?$("#checkall").prop("checked",!0):$("#checkall").prop("checked",!1)}function updateCharCount(e){var t=e,a=$("#current");$("#maximum"),$("#the-count");a.text(t)}$("#summernote").summernote({height:200,minHeight:100,maxHeight:700,disableDragAndDrop:!0,toolbar:[["font",["bold","underline","italic","clear"]],["fontname",["fontname","fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link","picture"]],["view",["codeview"]]],callbacks:{onImageLinkInsert:function(e){e.length&&$(this).summernote("insertImage",e)}}});var imageUploadDiv=$("div.note-group-select-from-files");imageUploadDiv.length&&imageUploadDiv.remove(),$(".note-color button.dropdown-toggle").html('<i class="note-icon-caret"></i>'),$(".noread").attr("readonly",!0),$(".noread").css("background-color","white"),$(".noread").click((function(){$(".noread").attr("readonly",!1)}));
